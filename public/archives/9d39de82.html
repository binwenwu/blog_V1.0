<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>K8S集群环境搭建(Containerd作为容器) | TANKENQI</title><meta name="author" content="贪肯奇,2390726421@qq.com"><meta name="copyright" content="贪肯奇"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="1 前述1.1 云原生定义 Pivotal《传统应用和SOA向云原生转型指南》（2015）的云原生的特征： 符合 12 要素应用 基准代码：一份基准代码，多份部署（类似于Git版本控制系统的main分支）； 显示声明所有依赖关系：通过依赖清单，确切地声明所有依赖项； 把后端服务当作附加资源：各种后端服务（如数据库、消息队列、邮件服务、缓存系统），不区别对待本地或第三方服务； 构建、发布、运行：严格">
<meta property="og:type" content="article">
<meta property="og:title" content="K8S集群环境搭建(Containerd作为容器)">
<meta property="og:url" content="https://binwenwu.github.io/archives/9d39de82.html">
<meta property="og:site_name" content="TANKENQI">
<meta property="og:description" content="1 前述1.1 云原生定义 Pivotal《传统应用和SOA向云原生转型指南》（2015）的云原生的特征： 符合 12 要素应用 基准代码：一份基准代码，多份部署（类似于Git版本控制系统的main分支）； 显示声明所有依赖关系：通过依赖清单，确切地声明所有依赖项； 把后端服务当作附加资源：各种后端服务（如数据库、消息队列、邮件服务、缓存系统），不区别对待本地或第三方服务； 构建、发布、运行：严格">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/binwenwu/picgo_demo/img/u%3D2793533854%2C2733450472%26fm%3D253%26fmt%3Dauto%26app%3D138%26f%3DJPEG">
<meta property="article:published_time" content="2023-08-06T07:08:12.000Z">
<meta property="article:modified_time" content="2023-09-08T04:54:50.000Z">
<meta property="article:author" content="贪肯奇">
<meta property="article:tag" content="K8S">
<meta property="article:tag" content="Containerd">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/binwenwu/picgo_demo/img/u%3D2793533854%2C2733450472%26fm%3D253%26fmt%3Dauto%26app%3D138%26f%3DJPEG"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/binwenwu/picgo_demo/img/08-crocodile.svg"><link rel="canonical" href="https://binwenwu.github.io/archives/9d39de82.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="baidu-site-verification" content="codeva-ok3ly5jyG3"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="/css/font-style.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'K8S集群环境搭建(Containerd作为容器)',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-09-08 12:54:50'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/font-style.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/js-heo@1.0.11/mainColor/heoMainColor.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/js-heo@1.0.11/categoryBar/categoryBar.css"><link rel="stylesheet" href="https://cdn1.tianli0.top/gh/zhheo/Post-Abstract-AI@0.9/tianli_gpt.css"><link rel="stylesheet" href="/css/winbox.css"><link rel="stylesheet" href="/css/fps.css"><link rel="stylesheet" href="/css/twikoo.css"><link rel="stylesheet" href="/css/rightmenu.css"><link rel="stylesheet" href="/css/iconfont.css"><style id="barragesColor"></style><link rel="stylesheet" href="/css/commentBarrage.css"><link rel="stylesheet" href="/css/records.css"><link rel="stylesheet" href="/css/icat.css"><link rel="stylesheet" href="/css/icat_change.css"><link rel="stylesheet" href="/css/color.css"><link rel="stylesheet" href="/css/subscribe.css"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-card-history/baiduhistory/css/main.css"><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/clock.min.css" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-double-row-display@1.00/cardlistpost.min.css"/>
<style>#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags:before {content:"\A";
  white-space: pre;}#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags > .article-meta__separator{display:none}</style>
<link rel="stylesheet" href="https://cdn1.tianli0.top/npm/hexo-butterfly-footer-marcus/lib/footer.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/rss2.xml" title="TANKENQI" type="application/rss+xml">
</head><body><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><div class="loading-img" style="background-image:url(https://cdn.jsdelivr.net/gh/binwenwu/picgo_demo/img/c933509f3fcc721e6f8e8612f7ec8725.jpeg);background-repeat: no-repeat;background-position:center;"></div><div class="loading-image-dot"></div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = 'auto';
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load',() => { preloader.endLoading() })

  if (false) {
    document.addEventListener('pjax:send', () => { preloader.initLoading() })
    document.addEventListener('pjax:complete', () => { preloader.endLoading() })
  }
})()</script><script>window.paceOptions = {
  restartOnPushState: false
}

document.addEventListener('pjax:send', () => {
  Pace.restart()
})
</script><link rel="stylesheet" href="/css/icat_change.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://cdn.jsdelivr.net/gh/binwenwu/picgo_demo/img/c933509f3fcc721e6f8e8612f7ec8725.jpeg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">14</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">22</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fa-solid fa-book"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/subscribe/"><i class="fa-fw fas fa-solid fa-cloud"></i><span> 订阅</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fas fa-solid fa-paperclip"></i><span> 我的</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/stars/"><i class="fa-fw fas fa-star"></i><span> 收藏网址</span></a></li><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-solid fa-user-group"></i><span> 友情链接</span></a></li><li><a class="site-page child" href="/records/"><i class="fa-fw fas fa-solid fa-heart"></i><span> 文字瞬间</span></a></li><li><a class="site-page child" href="/bilibili/"><i class="fa-fw iconfont icon-bilibili"></i><span> 番剧广场</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fas fa-solid fa-share"></i><span> 关于</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-solid fa-user"></i><span> 关于我</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/gh/binwenwu/picgo_demo/img/%E7%A7%8B%E5%A4%A9%E9%A3%8E%E6%99%AF%20%E6%A0%91%20%E7%8B%97%20%E8%90%BD%E5%8F%B6%20%E9%AB%98%E5%B1%B1%20%E5%94%AF%E7%BE%8E%E6%84%8F%E5%A2%83%E9%A3%8E%E6%99%AF4k%E5%A3%81%E7%BA%B8_%E5%BD%BC%E5%B2%B8%E5%9B%BE%E7%BD%91.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="TANKENQI"><span class="site-name">TANKENQI</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fa-solid fa-book"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/subscribe/"><i class="fa-fw fas fa-solid fa-cloud"></i><span> 订阅</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fas fa-solid fa-paperclip"></i><span> 我的</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/stars/"><i class="fa-fw fas fa-star"></i><span> 收藏网址</span></a></li><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-solid fa-user-group"></i><span> 友情链接</span></a></li><li><a class="site-page child" href="/records/"><i class="fa-fw fas fa-solid fa-heart"></i><span> 文字瞬间</span></a></li><li><a class="site-page child" href="/bilibili/"><i class="fa-fw iconfont icon-bilibili"></i><span> 番剧广场</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fas fa-solid fa-share"></i><span> 关于</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-solid fa-user"></i><span> 关于我</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">K8S集群环境搭建(Containerd作为容器)</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-08-06T07:08:12.000Z" title="发表于 2023-08-06 15:08:12">2023-08-06</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-09-08T04:54:50.000Z" title="更新于 2023-09-08 12:54:50">2023-09-08</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/">云原生</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/K8S/">K8S</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">9.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>40分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="K8S集群环境搭建(Containerd作为容器)"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="1-前述"><a href="#1-前述" class="headerlink" title="1 前述"></a>1 前述</h2><h3 id="1-1-云原生定义"><a href="#1-1-云原生定义" class="headerlink" title="1.1 云原生定义"></a>1.1 云原生定义</h3><ul>
<li><strong>Pivotal《传统应用和SOA向云原生转型指南》（2015）的云原生的特征：</strong><ul>
<li>符合 12 要素应用<ul>
<li><font color='blue'>基准代码</font>：一份基准代码，多份部署（类似于Git版本控制系统的main分支）；</li>
<li><font color='blue'>显示声明所有依赖关系</font>：通过依赖清单，确切地声明所有依赖项；</li>
<li><font color='blue'>把后端服务当作附加资源</font>：各种后端服务（如数据库、消息队列、邮件服务、缓存系统），不区别对待本地或第三方服务；</li>
<li><font color='blue'>构建、发布、运行</font>：严格区分构建、发布、运行这三个步骤；</li>
<li><font color='blue'>无状态进程</font>：应用的进程必须无状态；</li>
<li><font color='blue'>端口绑定</font>：互联网应用通过端口绑定来提供服务，并监听发送至该端口的请求。应用完全自我加载，不依赖于任何网络服务器；</li>
<li><font color='blue'>并发</font>：通过进程模型进行扩展。进程是一等公民；</li>
<li><font color='blue'>易处理</font>：进程可以瞬间开启或停止，有利于快速、弹性的伸缩应用。进程应追求最小启动时间；进程一旦接受终止信号就会优化的终止；进程在面对突然死亡时保持健壮；</li>
<li><font color='blue'>开发环境与线上环境等价</font>：尽可能的保持开发，预发布，线上环境相同，以尽量做到持续部署；</li>
<li><font color='blue'>日志</font>：应用本身从不存储自己的输出流，不应该试图去写或者管理日志文件，相反，每一个运行的进程都会直接的标准输出（stdout）事件流；</li>
<li><font color='blue'>管理进程</font>：后台管理任务当作一次性进程运行；</li>
</ul>
</li>
<li>面向微服务架构<ul>
<li>微服务将<font color='blue'>单体系统</font>分解为多个“仅做好一件事”的可独立部署的服务。这件事通常代表某项业务能力，或者最小可提供业务价值的“原子“服务单元。具备以下优点：<ul>
<li><font color='blue'>变更周期解耦</font>：只要变更限于单一有界的环境，并且服务继续履行其现有合约；实现了更频繁和快速的部署，从而实现了持续的价值流动；</li>
<li><font color='blue'>减少业务领域和现有代码的学习负担</font>；</li>
<li><font color='blue'>可以加快采用新技术的步伐</font>；</li>
<li><font color='blue'>提供独立、高效的服务扩展</font>；</li>
</ul>
</li>
</ul>
</li>
<li>自服务敏捷架构（可以认为是DevOps）：<ul>
<li>一个能够持续部署和运行这些微服务的平台；如代码以Git形式“推送”。 然后，自服务敏捷平台构建应用程序工件，构建应用程序环境，部署应用程序，并启动必要的进程。 团队不必考虑他们的代码在哪里运行或如何到达那里，这些对用户都是透明得，因为平台会关注这些。</li>
</ul>
</li>
<li>基于 API 的协作</li>
<li>抗脆弱性</li>
</ul>
</li>
<li><strong>云原生计算基金会（2015）定义的特征</strong><ul>
<li>应用容器化</li>
<li>面向微服务架构</li>
<li>应用支持容器的编排制度</li>
</ul>
</li>
<li><strong>云原生计算基金会（2018）定义</strong><ul>
<li>云原生技术有利于各组织在公有云、私有云和混合云等新型动态环境中，构建和运行可弹性扩展的应用。云原生的代表技术包括容器、服务网格、微服务、不可变基础设施和声明式 API</li>
<li>这些技术能够构建容错性好、易于管理和便于观察的松耦合系统。结合可靠的自动化手段，云原生技术使工程师能够轻松地对系统作出频繁和可预测的重大变更</li>
</ul>
</li>
</ul>
<h3 id="1-2-容器、虚拟机、Docker、Openstack-和-K8S"><a href="#1-2-容器、虚拟机、Docker、Openstack-和-K8S" class="headerlink" title="1.2 容器、虚拟机、Docker、Openstack 和 K8S"></a>1.2 容器、虚拟机、Docker、Openstack 和 K8S</h3><ul>
<li><strong>容器&amp;虚拟机</strong>：均为虚拟化技术，容器更为轻量化、效率更高、启动更快；虚拟机需数分钟启动，容器仅需数十毫秒；</li>
<li><strong>Docker</strong>： 容器化虚拟技术事实上的标准；</li>
<li><strong>OpenStack</strong>：分布式的虚拟机服务平台，相比于普通的虚拟机软件（如Vmare），多了分布式虚拟机调度管理的功能和节点的负载均衡； </li>
<li><strong>K8S</strong>：分布式的容器调度管理平台，相比于Docker，多了分布式的容器调度管理和节点的负载均衡；</li>
<li><strong>注意</strong>：常见的中文资料均言K8S是容器编排软件，这里的编排是指调度、管理的意思，而非工作流编排的意思，容易有误导性；</li>
<li><strong>注意</strong>：无论是Openstack还是K8S，均不支持跨节点的容器或虚拟机的创建；所以将多台电脑合并成一台电脑的想法是不现实的；</li>
</ul>
<h3 id="1-3-K8S-和-云原生"><a href="#1-3-K8S-和-云原生" class="headerlink" title="1.3 K8S 和 云原生"></a>1.3 K8S 和 云原生</h3><p>在单机上运行容器，无法发挥它的最大效能，只有形成集群，才能最大程度发挥容器的良好隔离、资源分配与编排管理的优势，而对于容器的编排管理，Swarm、Mesos 和 Kubernetes 的大战已经基本宣告结束，Kubernetes 成为了无可争议的赢家。</p>
<ul>
<li>Kubernetes 成为云原生应用的基石</li>
<li>有机会成为跨云的真正的云原生应用的操作系统</li>
</ul>
<h3 id="1-4-K8S-介绍"><a href="#1-4-K8S-介绍" class="headerlink" title="1.4 K8S 介绍"></a>1.4 K8S 介绍</h3><ul>
<li><strong><font color='red'>官方</font></strong>：<strong>Kubernetes</strong> 也称为 <strong>K8S</strong>，是用于自动部署、扩缩和管理容器化应用程序的开源系统。</li>
<li><strong><font color='red'>发展历史</font></strong>：由<strong>Google</strong>设计并捐赠给<strong>Cloud Native Computing Foundation</strong>（今属<strong>Linux</strong>基金会）来使用。</li>
<li><strong><font color='red'>能力</font></strong>：<strong>Google</strong> 每周运行数十亿个容器，能够在不扩张运维团队的情况下进行规模扩展。</li>
<li><strong><font color='red'>作用</font></strong>： 相当于一个操作系统，可以快速提供<strong>PaaS</strong>服务：1）创建各种容器化测试化环境；2）发布各种容器化服务；3）快速安装各种容器化服务，如MongoDB、<strong>Hbase</strong>、<strong>Postgresql</strong>、<strong>Redis</strong>、<strong>Spark</strong>等；快速提供IaaS服务：通过安装<strong>Openstack</strong>或<strong>KubeVirt</strong>等软件；快速提供<strong>FaaS</strong>服务：通过安装<strong>Kube</strong> <strong>Native</strong>等软件；</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/binwenwu/picgo_demo/img/image-20230414170948460.png" alt="image-20230414170948460"></p>
<p><img src="https://cdn.jsdelivr.net/gh/binwenwu/picgo_demo/img/image-20230414171119324.png" alt="image-20230414171119324"></p>
<h3 id="1-5-基本概念"><a href="#1-5-基本概念" class="headerlink" title="1.5 基本概念"></a>1.5 基本概念</h3><ul>
<li><strong>Container</strong>：轻量级的系统虚拟化技术，使用namespace隔离环境。</li>
<li><strong>Pod</strong>：</li>
<li><ul>
<li><strong>K8S</strong> 的调度的基本单位，<strong>Pod</strong>是一组紧密关联的容器集合，内部的容器共享PID、IPC、Network和UTS namespace。可以通过进程间通信和文件共享这种简单高效的方式组合完成服务。</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/binwenwu/picgo_demo/img/image-20230415141540422.png" alt="image-20230415141540422"></p>
</li>
</ul>
<p>​                Pod的设计理念基础是微服务，不同类型的业务组合由不同类型的Pod执行，一个Pod对应一个微服务</p>
<ul>
<li><ul>
<li>K8S中，采用manifest（yaml或json）定义对象，比如nginx服务（包含了一个nginx 容器image）定义为：</li>
</ul>
</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">ports:</span></span><br></pre></td></tr></table></figure>
<ul>
<li><ul>
<li><strong>Node:</strong> 是Pod运行的主机，可以为物理机，也可以为虚拟机。每个Node上要运行container runtime （docker或者rkt）、kubelet和kube-proxy服务</li>
<li><img src="https://cdn.jsdelivr.net/gh/binwenwu/picgo_demo/img/image-20230415142123300.png" alt="image-20230415142123300"></li>
</ul>
</li>
<li><ul>
<li><strong>Service:</strong> 一个Pod只是一个运行服务的实例，可能在一个节点上停止，在另一个节点以一个新的IP启动一个新的Pod。在K8S集群中，客户端需要访问的服务就是Service对象。每个Service会对应一个集群内部有效的虚拟IP，集群内部通过虚拟IP访问一个服务。</li>
</ul>
</li>
<li><ul>
<li><strong>Kubelet:</strong>  每个Node的任务和资源管理</li>
</ul>
</li>
<li><ul>
<li><strong>Kube-proxy:</strong>  负责每个节点的硬件负载均衡</li>
</ul>
</li>
</ul>
<h3 id="1-6-K8S-常见命令"><a href="#1-6-K8S-常见命令" class="headerlink" title="1.6 K8S 常见命令"></a>1.6 K8S 常见命令</h3><ul>
<li><strong>运行一个Nginix容器：</strong> <ul>
<li><code>kubectl run --image=nginx:alpine nginx-app --port=80</code></li>
</ul>
</li>
<li><strong>Kubectl 命令：</strong><ul>
<li><code>kubectl get - 类似于 docker ps，查询资源列表</code></li>
<li><code>kubectl describe - 类似于 docker inspect，获取资源的详细信息</code></li>
<li><code>kubectl logs - 类似于 docker logs，获取容器的日志</code></li>
<li><code>kubectl exec - 类似于 docker exec，在容器内执行一个命令</code></li>
<li><code>kubectl create -f file.yaml – 根据yaml创建Deployment资源</code></li>
<li><code>kubectl delete 删除命令，可删除node、pod、svc、depolyment</code></li>
</ul>
</li>
<li><strong>yaml 定义 Pod：</strong></li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Volume：</strong><ul>
<li>一个<strong>Pod</strong>一旦发生异常，<strong>Pod</strong> 产生的数据会随着 <strong>Pod</strong> 消亡而自动消失。<strong>Volume</strong> 用于持久化容器数据。</li>
<li>如：为 <strong>redis</strong> 容器指定一个 <strong>hostPath</strong> 来存储 <strong>redis</strong> 数据</li>
</ul>
</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">redis</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">volumeMounts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">redis-persistent-storage</span></span><br><span class="line">      <span class="attr">mountPath:</span> <span class="string">/data/redis</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">redis-persistent-storage</span></span><br><span class="line">    <span class="attr">hostPath:</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">/data/</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Service：</strong><ul>
<li>kubectl创建Pod，Pob的IP地址会随着Pod的重启而变化</li>
<li>为了访问Pod提供的服务，采用Service提供为一组Pod一个统一的入口，并提供负载均衡和<strong>自动服务发现</strong>。<ul>
<li><code>kubectl expose deployment nginx-app --port=80 --target-port=80 --type=NodePort</code></li>
</ul>
</li>
</ul>
</li>
<li><strong>Replicas set：</strong><ul>
<li>在一个Service中,可为Pod设置数个副本，以确保服务永不掉线<ul>
<li><code>kubectl scale --replicas=3 deployment/nginx-app</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/binwenwu/picgo_demo/img/image-20230415143046325.png" alt="image-20230415143046325"></p>
<ul>
<li><strong>滚动升级（Rolling Update）：</strong><ul>
<li>滚动升级（Rolling Update）通过逐个副本容器替代升级的方式来实现无中断的服务升级：<ul>
<li><code>kubectl rolling-update frontend-v1 frontend-v2 --image=image:v2</code></li>
</ul>
</li>
<li>滚动升级中若发生错误，可随时回滚：<ul>
<li><code>kubectl rolling-update frontend-v1 frontend-v2 --rollback</code></li>
</ul>
</li>
</ul>
</li>
<li><strong>资源限制：</strong><ul>
<li>K8S通过 cgroups 提供容器资源管理的功能，可限制每个容器的 CPU 和内存使用，比如对于刚才创建的 deployment，可以通过下面的命令限制 nginx 容器最多只用 50% 的 CPU 和 128MB 的内存：<ul>
<li><code>kubectl set resources deployment nginx-app -c=nginx --limits=cpu=500m,memory=128Mi</code></li>
</ul>
</li>
<li>或者在yaml中指定资源限制</li>
</ul>
</li>
<li><strong>健康检查：</strong><ul>
<li>K8S Kubernetes 提供了两种探针（Probe，支持 exec、tcpSocket 和 http 方式）来探测容器的状态：<ul>
<li>LivenessProbe：探测应用是否处于健康状态，如果不健康则删除并重新创建容器</li>
<li>ReadinessProbe：探测应用是否启动完成并且处于正常服务状态，如果不正常则不会接收来自 Kubernetes Service 的流量</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="1-7-K8S-常用运维命令"><a href="#1-7-K8S-常用运维命令" class="headerlink" title="1.7 K8S 常用运维命令"></a>1.7 K8S 常用运维命令</h3><ul>
<li><strong>查看pod，及所在的节点：</strong><ul>
<li><code>kubectl get pods -o wide</code></li>
</ul>
</li>
<li><strong>若有节点warn，回收垃圾失败：</strong></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl drain --delete-local-data --ignore-daemonsets NODENAME</span><br><span class="line">kubectl uncordon NODENAME</span><br></pre></td></tr></table></figure>
<h2 id="2-K8S-集群基础环境部署"><a href="#2-K8S-集群基础环境部署" class="headerlink" title="2 K8S 集群基础环境部署"></a>2 K8S 集群基础环境部署</h2><p class='p red'>若服务器之前搭建过 K8S 集群，需要彻底删除</p>
<p><span style="color:red">参考</span>：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/qq_43159578/article/details/124131709">https://blog.csdn.net/qq_43159578/article/details/124131709</a> </p>
<ul>
<li>停止所有的Kubernetes服务</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl stop kubelet</span><br><span class="line">sudo systemctl stop containerd</span><br></pre></td></tr></table></figure>
<ul>
<li>删除Kubernetes软件包</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum remove kubeadm kubectl kubelet kubernetes-cni -y</span><br></pre></td></tr></table></figure>
<ul>
<li>删除配置文件</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 清除残留文件</span></span><br><span class="line"><span class="built_in">rm</span> -rf /root/.kube</span><br><span class="line"><span class="built_in">rm</span> -rf /etc/cni/net.d</span><br><span class="line"><span class="built_in">rm</span> -rf /etc/kubernetes/*</span><br></pre></td></tr></table></figure>
<ul>
<li>删除etcd数据目录</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">rm</span> -rf /var/lib/etcd</span><br></pre></td></tr></table></figure>
<ul>
<li>清除iptables或者ipvs的配置</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sudo ipvsadm -C</span></span><br><span class="line"><span class="comment"># sudo iptables -F &amp;&amp; sudo iptables -t nat -F &amp;&amp; sudo iptables -t mangle -F &amp;&amp; sudo # # iptables -Xkubec</span></span><br></pre></td></tr></table></figure>
<ul>
<li><font color='red'>如果只是想重新部署集群</font>

</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubeadm reset</span><br></pre></td></tr></table></figure>
<p><code>kubeadm reset</code> 命令用于清除当前节点上所有与 <code>kubeadm init</code> 或 <code>kubeadm join</code> 命令创建的 Kubernetes 集群相关的状态。其主要作用如下：</p>
<ol>
<li><p>移除 Kubernetes 集群相关的系统服务，如 kubelet 和 kube-proxy。</p>
</li>
<li><p>删除所有在当前节点上创建的 Kubernetes 对象，包括 Pod、Service、Deployment 等。</p>
</li>
<li><p>移除 etcd 中与当前节点相关的信息，如节点标识、配置信息等。</p>
</li>
<li><p>删除 Kubernetes 数据目录，包括证书、密钥、kubeconfig 文件等。</p>
</li>
</ol>
<p>使用 <code>kubeadm reset</code> 命令可以清除当前节点上的所有 Kubernetes 相关状态，以便重新创建新的 Kubernetes 集群或者将当前节点加入到另一个 Kubernetes 集群中。在进行 <code>kubeadm reset</code> 操作之前，应该先备份当前节点上的重要数据和配置信息，以便在需要时进行恢复。</p>
<h3 id="2-1-服务器"><a href="#2-1-服务器" class="headerlink" title="2.1 服务器"></a>2.1 服务器</h3><ul>
<li><strong>网络资源：</strong>各节点间通过<strong>千兆交换机</strong>互联（非光纤交换机）</li>
<li><strong>管理节点：</strong><ul>
<li><font color='blue'>Gisweb4，Gisweb3</font></li>
</ul>
</li>
<li><strong>计算节点：</strong><ul>
<li><font color='blue'>Gisweb3，GISweb2，dellm640-01, Gisweb4, dellslot03, dellslot4</font></li>
</ul>
</li>
<li><strong>持久化存储资源：</strong><ul>
<li>目前采用：<ul>
<li><font color='blue'>nfs-client: 23服务器的/mnt/storage/k8s/pv</font></li>
</ul>
</li>
</ul>
</li>
<li><strong>Node1（刀片3）：</strong><ul>
<li><font color='blue'>子网 IP：192.168.0.177</font></li>
<li><font color='blue'>CPU：Intel(R) Xeon(R) Silver 4216 CPU @ 2.10GHz；32核心</font><font color='red'>，64线程。</font></li>
<li><font color='blue'>内存：64GB（32GB*2），每根DDR4，</font><font color='red'>3000Mhz</font></li>
</ul>
</li>
<li><strong>Node2（刀片4）：</strong><ul>
<li><font color='blue'>子网 IP：192.168.0.209</font></li>
<li><font color='blue'>CPU：Intel(R) Xeon(R) Silver 4216 CPU @ 2.10GHz；32核心</font>，<font color='red'>64线程。</font></li>
<li><font color='blue'>内存：64GB（32GB*2），每根DDR4</font><font color='red'>3200Mhz</font>



</li>
</ul>
</li>
</ul>
<h3 id="2-2-安装过程"><a href="#2-2-安装过程" class="headerlink" title="2.2 安装过程"></a>2.2 安装过程</h3><h4 id="2-2-1-前提条件"><a href="#2-2-1-前提条件" class="headerlink" title="2.2.1 前提条件"></a>2.2.1 前提条件</h4><p>a.    节点之中不可以有重复的主机名、<code>MAC</code> 地址或 <code>product_uuid</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /sys/class/dmi/id/product_uuid</span><br></pre></td></tr></table></figure>
<p>b.    检查网络适配器：若有多个网卡，确保每个node的子网通过默认路由可达</p>
<p>c.    防火墙开放端口<font color='red'>(所有节点)</font>：</p>
<p><img src="https://cdn.jsdelivr.net/gh/binwenwu/picgo_demo/img/image-20230415145138479.png" alt="image-20230415145138479"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart firewalld</span><br><span class="line">firewall-cmd --zone=public --add-port=443/tcp --permanent</span><br><span class="line">firewall-cmd --zone=public --add-port=6443/tcp --permanent</span><br><span class="line">firewall-cmd --zone=public --add-port=2379-2380/tcp --permanent</span><br><span class="line">firewall-cmd --zone=public --add-port=10250/tcp --permanent</span><br><span class="line">firewall-cmd --zone=public --add-port=10259/tcp --permanent</span><br><span class="line">firewall-cmd --zone=public --add-port=10257/tcp --permanent</span><br></pre></td></tr></table></figure>
<p>d.    关闭防火墙<font color='red'>(所有节点）</font>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop firewalld NetworkManager</span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld NetworkManager</span><br></pre></td></tr></table></figure>
<p>e.    关闭交换分区并禁用 SELinux<font color='red'>（所有节点）</font>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看 交换分区</span></span><br><span class="line">free -m</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将 `SELinux` 设置为 `permissive` 模式（相当于将其禁用）  第一行是临时禁用，第二行是永久禁用</span></span><br><span class="line">setenforce 0</span><br><span class="line">sed -i <span class="string">&#x27;s/^SELINUX=enforcing$/SELINUX=permissive/&#x27;</span> /etc/selinux/config</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭swap；第一行是临时禁用，第二行是永久禁用</span></span><br><span class="line">swapoff -a  </span><br><span class="line">sed -ri <span class="string">&#x27;s/.*swap.*/#&amp;/&#x27;</span> /etc/fstab</span><br><span class="line"></span><br><span class="line"><span class="comment"># 允许 iptables 检查桥接流量 （K8s 官方要求）</span></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF | sudo tee /etc/modules-load.d/k8s.conf</span></span><br><span class="line"><span class="string">br_netfilter</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF | sudo tee /etc/sysctl.d/k8s.conf</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-ip6tables = 1</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-iptables = 1</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 让配置生效</span></span><br><span class="line">sysctl --system</span><br></pre></td></tr></table></figure>
<p>f.    时间同步<font color='red'>（所有节点）</font>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yum install chrony -y</span><br><span class="line">systemctl start chronyd</span><br><span class="line">systemctl <span class="built_in">enable</span> chronyd</span><br><span class="line">chronyc sources</span><br></pre></td></tr></table></figure>
<p>g.    设置主机名并添加 ip 映射<font color='red'>（所有节点）</font>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 以 gisweb4 为例</span></span><br><span class="line"><span class="comment"># 查看主机名cat </span></span><br><span class="line">hostname</span><br><span class="line"><span class="comment"># 设置主机名</span></span><br><span class="line">hostnamectl set-hostname gisweb4</span><br><span class="line"><span class="comment"># 更新</span></span><br><span class="line">bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加 ip 映射</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;125.250.153.23  gisweb4&quot;</span> &gt;&gt; /etc/hosts</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;125.250.153.23  gisweb4&quot;</span> &gt;&gt; /etc/hosts</span><br><span class="line"><span class="comment"># 两台无外网ip的刀片添加内网ip</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># /etc/hosts 文件内容如下：</span></span><br><span class="line">192.168.0.203 gisweb1</span><br><span class="line">192.168.0.202 gisweb2</span><br><span class="line">192.168.0.204 gisweb4</span><br><span class="line">192.168.0.208 gisweb3</span><br><span class="line">192.168.0.176 dellm640-01</span><br><span class="line">192.168.0.177 dellm640-03</span><br><span class="line">192.168.0.209 dellslot04</span><br><span class="line"></span><br><span class="line">125.220.153.26 gisweb1</span><br><span class="line">125.220.153.25 gisweb2</span><br><span class="line">125.220.153.22 gisweb3</span><br><span class="line">125.220.153.23 gisweb4</span><br><span class="line">125.220.153.28 dellm640-01</span><br></pre></td></tr></table></figure>
<h4 id="2-2-2-升级-Linux-内核到最新（所有节点）："><a href="#2-2-2-升级-Linux-内核到最新（所有节点）：" class="headerlink" title="2.2.2 升级 Linux 内核到最新（所有节点）："></a>2.2.2 升级 Linux 内核到最新<font color='red'>（所有节点）</font>：</h4><p><strong>清除缓存，重新构建缓存：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 清除缓存</span></span><br><span class="line">yum makecache &amp; yum -y update</span><br></pre></td></tr></table></figure>
<p><strong><font color='red'>参考链接</font>：<em><font color='cyan'><a target="_blank" rel="noopener external nofollow noreferrer" href="https://zhuanlan.zhihu.com/p/368879345">https://zhuanlan.zhihu.com/p/368879345</a></font></em></strong></p>
<h4 id="2-2-3-转发-IPv4-并让-iptables-看到桥接流量（所有节点）"><a href="#2-2-3-转发-IPv4-并让-iptables-看到桥接流量（所有节点）" class="headerlink" title="2.2.3 转发 IPv4 并让 iptables 看到桥接流量（所有节点）"></a>2.2.3 转发 IPv4 并让 iptables 看到桥接流量<font color='red'>（所有节点）</font></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">a.	验证br_netfilter是否已经加载</span></span><br><span class="line">lsmod | grep br_netfilter</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">b.	加载br_netfilter模块：</span></span><br><span class="line">modprobe br_netfilter</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">c.	iptabels桥接</span></span><br><span class="line">cat &lt;&lt;EOF | sudo tee /etc/modules-load.d/k8s.conf</span><br><span class="line">overlay</span><br><span class="line">br_netfilter</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">modprobe overlay</span><br><span class="line">modprobe br_netfilter</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">设置所需的 sysctl 参数，参数在重新启动后保持不变</span></span><br><span class="line">cat &lt;&lt;EOF | sudo tee /etc/sysctl.d/k8s.conf</span><br><span class="line">net.bridge.bridge-nf-call-iptables  = 1</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="line">net.ipv4.ip_forward                 = 1</span><br><span class="line">EOF</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">应用 sysctl 参数而不重新启动</span></span><br><span class="line">sysctl --system</span><br></pre></td></tr></table></figure>
<h4 id="2-2-4-安装-ipvsadm（所有节点）"><a href="#2-2-4-安装-ipvsadm（所有节点）" class="headerlink" title="2.2.4  安装 ipvsadm（所有节点）"></a>2.2.4  安装 ipvsadm<font color='red'>（所有节点）</font></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">yum install ipvsadm ipset sysstat conntrack libseccomp -y</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF | sudo tee /etc/modules-load.d/ipvs.conf</span></span><br><span class="line"><span class="string">ip_vs</span></span><br><span class="line"><span class="string">ip_vs_rr</span></span><br><span class="line"><span class="string">ip_vs_wrr</span></span><br><span class="line"><span class="string">ip_vs_sh</span></span><br><span class="line"><span class="string">nf_conntrack</span></span><br><span class="line"><span class="string">ip_tables</span></span><br><span class="line"><span class="string">ip_set</span></span><br><span class="line"><span class="string">xt_set</span></span><br><span class="line"><span class="string">ipt_set</span></span><br><span class="line"><span class="string">ipt_rpfilter</span></span><br><span class="line"><span class="string">ipt_REJECT</span></span><br><span class="line"><span class="string">ipip</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">systemctl restart systemd-modules-load.service</span><br><span class="line"></span><br><span class="line">lsmod | grep -e ip_vs -e nf_conntrack</span><br></pre></td></tr></table></figure>
<h4 id="2-2-5-修改内核参数（所有节点，lb除外）"><a href="#2-2-5-修改内核参数（所有节点，lb除外）" class="headerlink" title="2.2.5 修改内核参数（所有节点，lb除外）"></a>2.2.5 修改内核参数<font color='red'>（所有节点，lb除外）</font></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF | sudo tee /etc/sysctl.d/k8s.conf</span></span><br><span class="line"><span class="string">net.ipv4.ip_forward = 1</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-iptables = 1</span></span><br><span class="line"><span class="string">fs.may_detach_mounts = 1</span></span><br><span class="line"><span class="string">vm.overcommit_memory=1</span></span><br><span class="line"><span class="string">vm.panic_on_oom=0</span></span><br><span class="line"><span class="string">fs.inotify.max_user_watches=89100</span></span><br><span class="line"><span class="string">fs.file-max=52706963</span></span><br><span class="line"><span class="string">fs.nr_open=52706963</span></span><br><span class="line"><span class="string">net.netfilter.nf_conntrack_max=2310720</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">net.ipv4.tcp_keepalive_time = 600</span></span><br><span class="line"><span class="string">net.ipv4.tcp_keepalive_probes = 3</span></span><br><span class="line"><span class="string">net.ipv4.tcp_keepalive_intvl =15</span></span><br><span class="line"><span class="string">net.ipv4.tcp_max_tw_buckets = 36000</span></span><br><span class="line"><span class="string">net.ipv4.tcp_tw_reuse = 1</span></span><br><span class="line"><span class="string">net.ipv4.tcp_max_orphans = 327680</span></span><br><span class="line"><span class="string">net.ipv4.tcp_orphan_retries = 3</span></span><br><span class="line"><span class="string">net.ipv4.tcp_syncookies = 1</span></span><br><span class="line"><span class="string">net.ipv4.tcp_max_syn_backlog = 16384</span></span><br><span class="line"><span class="string">net.ipv4.ip_conntrack_max = 65536</span></span><br><span class="line"><span class="string">net.ipv4.tcp_max_syn_backlog = 16384</span></span><br><span class="line"><span class="string">net.ipv4.tcp_timestamps = 0</span></span><br><span class="line"><span class="string">net.core.somaxconn = 16384</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">net.ipv6.conf.all.disable_ipv6 = 0</span></span><br><span class="line"><span class="string">net.ipv6.conf.default.disable_ipv6 = 0</span></span><br><span class="line"><span class="string">net.ipv6.conf.lo.disable_ipv6 = 0</span></span><br><span class="line"><span class="string">net.ipv6.conf.all.forwarding = 1</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">sysctl --systemS</span><br></pre></td></tr></table></figure>
<h4 id="2-2-6-安装Container-Runtime-选用containerd-弃用docker-："><a href="#2-2-6-安装Container-Runtime-选用containerd-弃用docker-：" class="headerlink" title="2.2.6 安装Container Runtime(选用containerd,弃用docker)："></a>2.2.6 安装Container Runtime<font color='red'>(选用containerd,弃用docker)</font>：</h4><ul>
<li><strong>Docker-engine+cir-dockerd方案（<font color='red'>舍弃</font>）</strong>：从kubernetes 1.24开始，dockershim已经从kubelet中移除，但因为历史问题docker却不支持kubernetes主推的CRI（容器运行时接口）标准，需要在kubelet和docker之间加上一个中间层cri-docker。cri-docker是一个支持CRI标准的shim。一头通过CRI跟kubelet交互，另一头跟docker api交互，从而间接的实现了kubernetes以docker作为容器运行时。但是这种架构缺点也很明显，<strong>调用链更长，效率更低</strong>。因此选用containerd作为容器runtime</li>
<li><strong>containerd</strong>方案: <strong>containerd</strong>是一个<strong>docker</strong>的容器<strong>runtime</strong>，成为<strong>CNCF</strong>的官方项目</li>
</ul>
<p>官方安装教程：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/containerd/containerd/blob/main/docs/getting-started.md">https://github.com/containerd/containerd/blob/main/docs/getting-started.md</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装containerd.io</span></span><br><span class="line">yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</span><br><span class="line">yum install containerd.io</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装CNI插件</span></span><br><span class="line"><span class="comment"># i.下载cni-plugins.tar 从https://github.com/containernetworking/plugins/releases</span></span><br><span class="line"><span class="comment"># 在线下载：</span></span><br><span class="line"><span class="comment"># wget https://github.com/containernetworking/plugins/releases/download/v1.1.1/cni-plugins-linux-amd64-v1.1.1.tgz</span></span><br><span class="line"><span class="comment"># ii.在/opt/cni/bin下解压：</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 把22上的拷贝到没有公网ip的服务器上</span></span><br><span class="line"><span class="comment"># scp -P22 /opt/cni/bin/cni-plugins-linux-amd64-v1.1.1.tgz root@192.168.0.203:/opt/cni/bin/</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> -p /opt/cni/bin</span><br><span class="line"><span class="built_in">cd</span> /opt/cni/bin</span><br><span class="line">tar Cxzvf /opt/cni/bin cni-plugins-linux-amd64-v1.1.1.tgz</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启服务：</span></span><br><span class="line">systemctl restart containerd</span><br><span class="line"><span class="comment"># 开机启动：</span></span><br><span class="line">systemctl <span class="built_in">enable</span> containerd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置systemd cgroup驱动</span></span><br><span class="line"><span class="comment"># 修改配置文件，将 SystemdCgroup 改为 true 注意配置项是区分大小写的</span></span><br><span class="line">containerd config default | sudo <span class="built_in">tee</span> /etc/containerd/config.toml</span><br><span class="line">vim /etc/containerd/config.toml</span><br><span class="line"></span><br><span class="line">[plugins.<span class="string">&quot;io.containerd.grpc.v1.cri&quot;</span>.containerd.runtimes.runc]</span><br><span class="line">  ...</span><br><span class="line">  [plugins.<span class="string">&quot;io.containerd.grpc.v1.cri&quot;</span>.containerd.runtimes.runc.options]</span><br><span class="line">    SystemdCgroup = <span class="literal">true</span></span><br><span class="line"><span class="comment"># 并将 sandbox_image 地址修改为国内的地址</span></span><br><span class="line">并且将 sandbox_image = <span class="string">&quot;registry.k8s.io/pause:3.6&quot;</span></span><br><span class="line">修改为 sandbox_image = <span class="string">&quot;registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.6&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动 containerd</span></span><br><span class="line">systemctl restart containerd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开机自启</span></span><br><span class="line">systemctl <span class="built_in">enable</span> containerd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动成功后可以查看到监听的端口</span></span><br><span class="line">netstat -nlput | grep containerd</span><br><span class="line">tcp        0      0 127.0.0.1:36669         0.0.0.0:*               LISTEN      8665/containerd      off (0.00/0/0)</span><br></pre></td></tr></table></figure>
<h4 id="2-2-7-在所有电脑上安装-kubeadm-kubelet-and-kubectl（所有节点）"><a href="#2-2-7-在所有电脑上安装-kubeadm-kubelet-and-kubectl（所有节点）" class="headerlink" title="2.2.7 在所有电脑上安装 kubeadm, kubelet and kubectl（所有节点）"></a>2.2.7 在所有电脑上安装 kubeadm, kubelet and kubectl<font color='red'>（所有节点）</font></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># a.	kubeadm: the command to bootstrap the cluster.</span></span><br><span class="line"><span class="comment"># b.	kubelet: the component that runs on all of the machines in your cluster and does things like starting pods and containers.</span></span><br><span class="line"><span class="comment"># c.	kubectl: the command line util to talk to your cluster.</span></span><br></pre></td></tr></table></figure>
<ol>
<li><em>配置阿里云的k8s源，加速安装</em></li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF | sudo tee /etc/yum.repos.d/kubernetes.repo</span></span><br><span class="line"><span class="string">[kubernetes]</span></span><br><span class="line"><span class="string">name=Kubernetes</span></span><br><span class="line"><span class="string">baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/</span></span><br><span class="line"><span class="string">enabled=1</span></span><br><span class="line"><span class="string">gpgcheck=1</span></span><br><span class="line"><span class="string">repo_gpgcheck=1</span></span><br><span class="line"><span class="string">gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
<ol>
<li><em>将 SELinux 设置为 permissive 模式（相当于将其禁用）</em></li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">setenforce 0</span><br><span class="line">sed -i <span class="string">&#x27;s/^SELINUX=enforcing$/SELINUX=permissive/&#x27;</span> /etc/selinux/config</span><br></pre></td></tr></table></figure>
<ol>
<li><em>安装</em></li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yum install -y --nogpgcheck kubelet-1.25.2 kubeadm-1.25.2 kubectl-1.25.2  </span><br><span class="line"><span class="comment"># sudo yum install -y --nogpgcheck kubelet-1.26.3 kubeadm-1.26.3 kubectl-1.26.3 </span></span><br><span class="line"><span class="comment"># 自启动</span></span><br><span class="line">systemctl <span class="built_in">enable</span> --now kubelet</span><br></pre></td></tr></table></figure>
<h4 id="2-2-8-启动控制面节点"><a href="#2-2-8-启动控制面节点" class="headerlink" title="2.2.8 启动控制面节点"></a>2.2.8 启动控制面节点</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubeadm init --kubernetes-version=v1.25.2 --image-repository registry.aliyuncs.com/google_containers --pod-network-cidr=10.244.0.0/16 </span><br><span class="line"></span><br><span class="line"><span class="comment">#kubeadm init --kubernetes-version=v1.26.3 --image-repository registry.aliyuncs.com/google_containers --pod-network-cidr=10.244.0.0/16 </span></span><br></pre></td></tr></table></figure>
<font color='red'>若出现如下错误（上一次集群初始化的残留文件）</font>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果出现报错  </span></span><br><span class="line">[ERROR FileAvailable--etc-kubernetes-manifests-kube-apiserver.yaml]: /etc/kubernetes/manifests/kube-apiserver.yaml already exists</span><br></pre></td></tr></table></figure>
<font color='red'>执行如下命令后再次初始化</font>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">rm</span> -rf /var/lib/etcd</span><br><span class="line"><span class="built_in">rm</span> -rf /etc/kubernetes/manifests/* </span><br></pre></td></tr></table></figure>
<h4 id="2-2-9-配置环境变量-初始化后"><a href="#2-2-9-配置环境变量-初始化后" class="headerlink" title="2.2.9 配置环境变量(初始化后)"></a>2.2.9 配置环境变量<font color='red'>(初始化后)</font></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p <span class="variable">$HOME</span>/.kube</span><br><span class="line"><span class="built_in">cp</span> -i /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span><br><span class="line"><span class="built_in">chown</span> $(<span class="built_in">id</span> -u):$(<span class="built_in">id</span> -g) <span class="variable">$HOME</span>/.kube/config</span><br></pre></td></tr></table></figure>
<h4 id="2-2-10-将-master-作为node（管理节点上执行）"><a href="#2-2-10-将-master-作为node（管理节点上执行）" class="headerlink" title="2.2.10 将 master 作为node（管理节点上执行）"></a>2.2.10 将 master 作为node（管理节点上执行）</h4><ul>
<li>检查 node 是否存在污点<ul>
<li>污点值有三种：<ul>
<li><font color='blue'>NoSchedule</font>：一定不被调度</li>
<li><font color='blue'>PreferNoSchedule</font>：尽量不被调度【也有被调度的几率】</li>
<li><font color='blue'>NoExecute</font>：不会调度，并且还会驱逐Node已有Pod</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl describe nodes gisweb4 |grep Taints</span><br></pre></td></tr></table></figure>
<ul>
<li>删除污点：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 本次删除的污点为：node-role.kubernetes.io/control-plane-</span></span><br><span class="line">kubectl taint nodes --all node-role.kubernetes.io/control-plane-</span><br></pre></td></tr></table></figure>
<h4 id="2-2-11-安装-Pod-网络插件（CNI：Container-Network-Interface）-master"><a href="#2-2-11-安装-Pod-网络插件（CNI：Container-Network-Interface）-master" class="headerlink" title="2.2.11 安装 Pod 网络插件（CNI：Container Network Interface）(master)"></a>2.2.11 安装 Pod 网络插件（CNI：Container Network Interface）<font color='red'>(master)</font></h4><p>你必须部署一个基于 Pod 网络插件的 容器网络接口 (CNI)，以便你的 Pod 可以相互通信。</p>
<font color='red'>确保kubeadm初始化时，pod_cidr 为10.244.0.0</font>

<ul>
<li>下载 <strong>yml</strong> 配置文件<ul>
<li>或自己下载到本地</li>
</ul>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl https://github.com/flannel-io/flannel/releases/latest/download/kube-flannel.yml -O</span><br></pre></td></tr></table></figure>
<ul>
<li>编辑<strong>kube-flannel.yml</strong><ul>
<li>找到如下位置，添加 <strong>iface-regex</strong></li>
</ul>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim kube-flannel.yml</span><br><span class="line"><span class="comment"># 添加</span></span><br><span class="line">- --iface-regex=^192.168..</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/binwenwu/picgo_demo/img/image-20230408114839608.png" alt=""></p>
<ul>
<li>构建</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f kube-flannel.yml</span><br></pre></td></tr></table></figure>
<h4 id="2-2-12-node-节点加入集群"><a href="#2-2-12-node-节点加入集群" class="headerlink" title="2.2.12 node 节点加入集群"></a>2.2.12 node 节点加入集群</h4><ul>
<li>管理节点获取加入命令：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubeadm token create --print-join-command</span><br><span class="line"><span class="comment"># 返回如下</span></span><br><span class="line">kubeadm <span class="built_in">join</span> 125.220.153.23:6443 --token x0wdaj.d5wltdzdtos22fl6 --discovery-token-ca-cert-hash sha256:9245d363cdeb1757bacba21b9ccdc06a28e7490bcedfb0eeb404b56f769fa112</span><br></pre></td></tr></table></figure>
<ul>
<li>在 node 节点执行生成命令</li>
</ul>
<p>如果此步报如下错误</p>
<p><span style="color:red">The connection to the server localhost:8080 was refused - did you specify the right host</span></p>
<ol>
<li><span style="color:blue">出现这个问题的原因是kubectl命令需要使用<code>kubernetes-admin</code>的身份来运行，在<code>kubeadm int</code>启动集群的步骤中就生成了<code>/etc/kubernetes/admin.conf</code>。</span></li>
<li><span style="color:blue">因此，解决方法如下，将主节点中的<code>/etc/kubernetes/admin.conf</code>文件拷贝到工作节点相同目录下：</span></li>
<li><span style="color:blue">然后分别在工作节点上配置环境变量：</span></li>
</ol>
<p class='p red'>解决方案</p>
<ul>
<li>主节点执行</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将主节点中的【/etc/kubernetes/admin.conf】文件拷贝到工作节点相同目录下：</span></span><br><span class="line">scp -P22 /etc/kubernetes/admin.conf oge@125.220.153.22:/etc/kubernetes/</span><br></pre></td></tr></table></figure>
<ul>
<li><code>node</code> 节点执行如下命令后，再次执行加入集群的命令</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;export KUBECONFIG=/etc/kubernetes/admin.conf&quot;</span> &gt;&gt; ~/.bash_profile</span><br><span class="line"><span class="built_in">source</span> ~/.bash_profile</span><br></pre></td></tr></table></figure>
<ul>
<li>如果是重新加入集群，需要 <code>reset</code> 一下</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubeadm reset</span><br></pre></td></tr></table></figure>
<h4 id="2-2-13-添加新的-master-节点"><a href="#2-2-13-添加新的-master-节点" class="headerlink" title="2.2.13 添加新的 master 节点"></a>2.2.13 添加新的 master 节点</h4><ul>
<li>管理节点：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 管理节点查看</span></span><br><span class="line">kubeadm token create --print-join-command</span><br><span class="line"><span class="comment"># 生成如下</span></span><br><span class="line">kubeadm <span class="built_in">join</span> 125.220.153.23:6443 --token mc56rw.t9b3d1ql53yhom9y --discovery-token-ca-cert-hash sha256:753ccf865a9c590413043d469a9848300871afaef7221e3fdb97d981939a2b83</span><br><span class="line"></span><br><span class="line"><span class="comment"># 管理节点</span></span><br><span class="line">kubeadm init phase upload-certs --upload-certs </span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line">I0413 11:00:30.817038   10009 version.go:256] remote version is much newer: v1.27.0; falling back to: stable-1.25</span><br><span class="line">[upload-certs] Storing the certificates <span class="keyword">in</span> Secret <span class="string">&quot;kubeadm-certs&quot;</span> <span class="keyword">in</span> the <span class="string">&quot;kube-system&quot;</span> Namespace</span><br><span class="line">[upload-certs] Using certificate key:</span><br><span class="line">70d43cde7f6423b5c3e88c0fa9d08511cefbc53992dc63a13544cd548a912941</span><br><span class="line"></span><br><span class="line"><span class="comment"># 管理节点，在networking前添加：controlPlaneEndpoint: 125.220.153.23:6443</span></span><br><span class="line">kubectl -n kube-system edit cm kubeadm-config</span><br></pre></td></tr></table></figure>
<ul>
<li>新的master节点</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 新节点</span></span><br><span class="line"><span class="comment"># 重新加入的话，检查是否需要kill掉6443端口（这是之前的api-service服务）</span></span><br><span class="line">kubeadm <span class="built_in">join</span> 125.220.153.23:6443 --token mc56rw.t9b3d1ql53yhom9y --discovery-token-ca-cert-hash sha256:753ccf865a9c590413043d469a9848300871afaef7221e3fdb97d981939a2b83 --control-plane --certificate-key 70d43cde7f6423b5c3e88c0fa9d08511cefbc53992dc63a13544cd548a912941</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成</span></span><br><span class="line">This node has joined the cluster and a new control plane instance was created:</span><br><span class="line"></span><br><span class="line">* Certificate signing request was sent to apiserver and approval was received.</span><br><span class="line">* The Kubelet was informed of the new secure connection details.</span><br><span class="line">* Control plane label and taint were applied to the new node.</span><br><span class="line">* The Kubernetes control plane instances scaled up.</span><br><span class="line">* A new etcd member was added to the <span class="built_in">local</span>/stacked etcd cluster.</span><br><span class="line"></span><br><span class="line">To start administering your cluster from this node, you need to run the following as a regular user:</span><br><span class="line"></span><br><span class="line">        <span class="built_in">mkdir</span> -p <span class="variable">$HOME</span>/.kube</span><br><span class="line">        sudo <span class="built_in">cp</span> -i /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span><br><span class="line">        sudo <span class="built_in">chown</span> $(<span class="built_in">id</span> -u):$(<span class="built_in">id</span> -g) <span class="variable">$HOME</span>/.kube/config</span><br><span class="line"></span><br><span class="line">Run <span class="string">&#x27;kubectl get nodes&#x27;</span> to see this node <span class="built_in">join</span> the cluster.</span><br></pre></td></tr></table></figure>
<h2 id="3-K8S-管理平台-dashboard-环境部署（管理节点）"><a href="#3-K8S-管理平台-dashboard-环境部署（管理节点）" class="headerlink" title="3 K8S 管理平台 dashboard 环境部署（管理节点）"></a>3 K8S 管理平台 dashboard 环境部署<font color='red'>（管理节点）</font></h2><ul>
<li>下载 <strong>yaml</strong> 配置文件并应用<ul>
<li>或下载到本地然后上传</li>
</ul>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.6.1/aio/deploy/recommended.yaml</span><br></pre></td></tr></table></figure>
<ul>
<li>修改配置文件(以node)<ul>
<li>但是这个只能内部访问，所以要外部访问，要么部署 ingress，要么就是设置 service NodePort 类型。这里选择 service 暴露端口。</li>
</ul>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">kubectl edit svc kubernetes-dashboard -n kubernetes-dashboard</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将其中的，type: ClusterIP 修改成type: NodePort，保存退出即可。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看服务的暴露端口，需在安全组放行</span></span><br><span class="line">kubectl get svc -A |grep kubernetes-dashboard</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/binwenwu/picgo_demo/img/image-20230415154841715.png" alt="image-20230415154841715"></p>
<ul>
<li>权限认证</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建访问用户</span></span><br><span class="line">kubectl apply -f https://kuboard.cn/install-script/k8s-dashboard/auth.yaml</span><br><span class="line"><span class="comment"># 获取访问令牌</span></span><br><span class="line">kubectl -n kubernetes-dashboard create token admin-user </span><br><span class="line"><span class="comment"># 生成的令牌</span></span><br><span class="line">eyJhbGciOiJSUzI1NiIsImtpZCI6IkdVQTZzb3JEM1FHdkpxVDNsSEwtVEZWc2hyR08tbmFFWnFGX2Q2OGt5cEkifQ.eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjLmNsdXN0ZXIubG9jYWwiXSwiZXhwIjoxNjgzNzM1MTQ1LCJpYXQiOjE2ODM3MzE1NDUsImlzcyI6Imh0dHBzOi8va3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxvY2FsIiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJrdWJlcm5ldGVzLWRhc2hib2FyZCIsInNlcnZpY2VhY2NvdW50Ijp7Im5hbWUiOiJhZG1pbi11c2VyIiwidWlkIjoiMzBlMWQzNDEtNDc0Yi00M2MyLWIyNzYtZGIxZTU4NzM5ZTgxIn19LCJuYmYiOjE2ODM3MzE1NDUsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDprdWJlcm5ldGVzLWRhc2hib2FyZDphZG1pbi11c2VyIn0.mg1IU29tBpH23nglJVbRmVa2A26WZjXxMCzckQyb-dnviLBRzBuvNebb8H4YH5CNJUPkB2GGC_r7dlm5zEbPpK8RqkbwXy-wqkOoMephs83gIQkJ3RgskpWqTgqqg87e6WXHRtuzYsQQZ4Rq3Y4uQy9jJS9o1lIoRTujpmpWORb9vu4JN0RqEfK2chQqNsYCe_TCtvtvkP2EyuU3QSeYdvWh5NNZ9CYwA8l8eqA6ijrmTqZjnI6Q9Ymo7trKSuGFmffotBpN9dTYZoyv6Io_VgEz6_1oHsA0pwG-3wc41Ly11sDAzwjZvoGN1yfw0vsVcwnAjH4LkRG2ImwYIcZbig</span><br></pre></td></tr></table></figure>
<ul>
<li>访问方式（每个节点 ip 均可访问）：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://125.220.153.23:30151">https://125.220.153.23:30151</a></li>
</ul>
<h2 id="4-安装K8S的包管理工具Helm-（管理节点）"><a href="#4-安装K8S的包管理工具Helm-（管理节点）" class="headerlink" title="4 安装K8S的包管理工具Helm （管理节点）"></a>4 安装K8S的包管理工具Helm <font color='red'>（管理节点）</font></h2><p><span style="color:red">参考</span>：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://helm.sh/docs/intro/install/">https://helm.sh/docs/intro/install/</a> </p>
<ul>
<li>这里以下载压缩包安装为例：</li>
</ul>
<p><span style="color:red">参考</span>：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.cnblogs.com/zhanglianghhh/p/14165995.html">https://www.cnblogs.com/zhanglianghhh/p/14165995.html</a><br><span style="color:red">github地址</span>：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/helm/helm">https://github.com/helm/helm</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/binwenwu/picgo_demo/img/image-20230413112634363.png" alt="image-20230413112634363"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span>  ~/k8s/helm</span><br><span class="line">wget https://get.helm.sh/helm-v3.11.3-linux-amd64.tar.gz</span><br><span class="line">tar zxfv helm-v3.11.3-linux-amd64.tar.gz</span><br><span class="line"><span class="built_in">mv</span> ./linux-amd64/helm /usr/bin/</span><br><span class="line"><span class="comment"># 显示版本，安装完成</span></span><br><span class="line">helm version</span><br></pre></td></tr></table></figure>
<h2 id="5-安装K8S的包管理工具-krew（管理节点）"><a href="#5-安装K8S的包管理工具-krew（管理节点）" class="headerlink" title="5 安装K8S的包管理工具 krew（管理节点）"></a>5 安装K8S的包管理工具 krew<code>（管理节点）</code></h2><p><span style="color:red">参考</span>：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://krew.sigs.k8s.io/docs/user-guide/setup/install/">https://krew.sigs.k8s.io/docs/user-guide/setup/install/</a>  </p>
<ul>
<li>确保 git 已经安装</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git version</span><br><span class="line"><span class="comment"># 若未安装</span></span><br><span class="line">yum -y install git</span><br></pre></td></tr></table></figure>
<ul>
<li>安装krew</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">(</span><br><span class="line">  <span class="built_in">set</span> -x; <span class="built_in">cd</span> <span class="string">&quot;<span class="subst">$(mktemp -d)</span>&quot;</span> &amp;&amp;</span><br><span class="line">  OS=<span class="string">&quot;<span class="subst">$(uname | tr &#x27;[:upper:]&#x27; &#x27;[:lower:]&#x27;)</span>&quot;</span> &amp;&amp;</span><br><span class="line">  ARCH=<span class="string">&quot;<span class="subst">$(uname -m | sed -e &#x27;s/x86_64/amd64/&#x27; -e &#x27;s/\(arm\)\(64\)\?.*/\1\2/&#x27; -e &#x27;s/aarch64$/arm64/&#x27;)</span>&quot;</span> &amp;&amp;</span><br><span class="line">  KREW=<span class="string">&quot;krew-<span class="variable">$&#123;OS&#125;</span>_<span class="variable">$&#123;ARCH&#125;</span>&quot;</span> &amp;&amp;</span><br><span class="line">  curl -fsSLO <span class="string">&quot;https://github.com/kubernetes-sigs/krew/releases/latest/download/<span class="variable">$&#123;KREW&#125;</span>.tar.gz&quot;</span> &amp;&amp;</span><br><span class="line">  tar zxvf <span class="string">&quot;<span class="variable">$&#123;KREW&#125;</span>.tar.gz&quot;</span> &amp;&amp;</span><br><span class="line">  ./<span class="string">&quot;<span class="variable">$&#123;KREW&#125;</span>&quot;</span> install krew</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ul>
<li>添加 <code>$HOME/.krew/bin</code>目录到您的 PATH 环境变量。  更新你的 <code>.bashrc</code>或者 <code>.zshrc</code>文件</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 永久写的用户的环境变量文件，避免登出后失效</span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="string">&quot;<span class="variable">$&#123;KREW_ROOT:-<span class="variable">$HOME</span>/.krew&#125;</span>/bin:<span class="variable">$PATH</span>&quot;</span></span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure>
<ul>
<li>若安装失败，采用压缩包安装</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/kubernetes-sigs/krew/releases/latest/download/krew-linux_amd64.tar.gz</span><br><span class="line"></span><br><span class="line">tar -zxvf krew-linux_amd64.tar.gz</span><br><span class="line"><span class="comment"># 添加$HOME/.krew/bin目录到PATH环境变量</span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="string">&quot;<span class="variable">$&#123;KREW_ROOT:-<span class="variable">$HOME</span>/.krew&#125;</span>/bin:<span class="variable">$PATH</span>&quot;</span></span><br><span class="line"><span class="comment"># 配置为 kubectl 插件</span></span><br><span class="line"><span class="built_in">mv</span> ./krew-linux_amd64 ./kubectl-krew</span><br><span class="line"><span class="built_in">mv</span> ./kubectl-krew /usr/local/bin/</span><br><span class="line"><span class="comment"># 测试</span></span><br><span class="line">kubectl krew version</span><br></pre></td></tr></table></figure>
<ul>
<li>检查是否安装成功</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl krew</span><br><span class="line">kubectl plugin list</span><br></pre></td></tr></table></figure>
<h2 id="6-为-K8S-创建-PV-持久卷"><a href="#6-为-K8S-创建-PV-持久卷" class="headerlink" title="6 为 K8S 创建 PV 持久卷"></a>6 为 K8S 创建 PV 持久卷</h2><h3 id="6-1-PV和PVC"><a href="#6-1-PV和PVC" class="headerlink" title="6.1 PV和PVC"></a>6.1 PV和PVC</h3><ul>
<li><p><font color='red'>持久卷(PersistentVolume，PV)</font>是集群中由管理员配置的一段网络存储。它是集群中的资源，就像节点是集群资源一样。PV持久卷和普通的Volume一样，也是使用卷插件来实现的，只是它们拥有独立于任何使用PV的Pod的生命周期。此API对象捕获存储实现的详细信息，包括NFS，iSCSI或特定于云提供程序的存储系统。</p>
</li>
<li><p><font color='red'>持久卷申领(PersistentVolumeClaim，PVC)</font>表达的是用户对存储的请求。概念上与Pod类似。Pod会耗用节点资源，而PVC申领会耗用PV资源。</p>
</li>
</ul>
<h3 id="6-2-用-storageClass-动态创建-PV"><a href="#6-2-用-storageClass-动态创建-PV" class="headerlink" title="6.2 用 storageClass 动态创建 PV"></a>6.2 用 storageClass 动态创建 PV</h3><ul>
<li><font color='green'>对1PB的大量目录创建NFS服务，gisweb1-4，以gisweb4为例子</font>

</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">安装NFS: </span><br><span class="line">yum -y install nfs-utils rpcbind</span><br></pre></td></tr></table></figure>
<ul>
<li><font color='green'>设置持久卷权限</font>

</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 执行权限</span></span><br><span class="line"><span class="built_in">chown</span> -R nobody:nfsnobody /mnt/storage/k8s/pv</span><br><span class="line"><span class="comment">#chmod -R 777 /mnt/storage/k8s/pv</span></span><br></pre></td></tr></table></figure>
<ul>
<li>配置 nfs</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/exports</span><br><span class="line"><span class="comment"># 添加：</span></span><br><span class="line">/mnt/storage/k8s/pv 192.168.0.0/24(rw,<span class="built_in">sync</span>,no_root_squash)</span><br><span class="line"><span class="comment"># 以上设置让所有的 IP 都有效</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">systemctl start rpcbind</span><br><span class="line">systemctl <span class="built_in">enable</span> rpcbind</span><br><span class="line">systemctl <span class="built_in">enable</span> nfs</span><br><span class="line">systemctl start nfs</span><br><span class="line">systemctl start nfs-server</span><br><span class="line">systemctl <span class="built_in">enable</span> nfs-server</span><br><span class="line"></span><br><span class="line">systemctl start firewalld</span><br><span class="line">firewall-cmd --permanent --add-service=nfs</span><br><span class="line">firewall-cmd  --reload</span><br><span class="line">systemctl stop firewalld &amp;&amp; sudo systemctl <span class="built_in">disable</span> firewalld</span><br></pre></td></tr></table></figure>
<ul>
<li>检查</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">exportfs -rv</span><br><span class="line">showmount -e 127.0.0.1</span><br></pre></td></tr></table></figure>
<ul>
<li><font color='red'>所有节点安装nfs客户端</font>

</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yum install -y nfs-utils</span><br><span class="line"><span class="comment"># 每个节点挂载nfs客户端的存储目录，本次nfs客户端在gisweb4（192.168.0.204）上</span></span><br><span class="line">mount -t nfs 192.168.0.204:/mnt/storage/k8s/pv /mnt/storage/k8s/pv </span><br><span class="line"><span class="comment"># 检查挂载情况</span></span><br><span class="line"><span class="built_in">df</span> -h</span><br></pre></td></tr></table></figure>
<ul>
<li>安装nfs-client-provisioner (需要翻墙)</li>
</ul>
<p>参考：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner"><strong>https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner</strong></a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 更新helm repo</span></span><br><span class="line">helm repo update</span><br><span class="line"><span class="comment"># 搜索helm库中nfs版本</span></span><br><span class="line">helm search repo nfs-subdir-external-provisioner</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加 helm 仓库</span></span><br><span class="line">helm repo add nfs-subdir-external-provisioner https://kubernetes-sigs.github.io/nfs-subdir-external-provisioner/</span><br><span class="line"></span><br><span class="line">helm install nfs-subdir-external-provisioner nfs-subdir-external-provisioner/nfs-subdir-external-provisioner \</span><br><span class="line">--<span class="built_in">set</span> nfs.server=192.168.0.204 \</span><br><span class="line">--<span class="built_in">set</span> nfs.path=/mnt/storage/k8s/pv	 \</span><br><span class="line">--<span class="built_in">set</span> image.repository=registry.cn-hangzhou.aliyuncs.com/xzjs/nfs-subdir-external-provisioner \</span><br><span class="line">--<span class="built_in">set</span> image.tag=v4.0.0</span><br></pre></td></tr></table></figure>
<ul>
<li><font color='red'>手动安装 nfs-client-provisioner</font>

</li>
</ul>
<p>参考：<a target="_blank" rel="noopener external nofollow noreferrer" href="http://www.mydlq.club/article/109/#%E5%88%9B%E5%BB%BA-nfs-subdir-external-provisioner-%E9%83%A8%E7%BD%B2%E6%96%87%E4%BB%B6">http://www.mydlq.club/article/109/#%E5%88%9B%E5%BB%BA-nfs-subdir-external-provisioner-%E9%83%A8%E7%BD%B2%E6%96%87%E4%BB%B6</a></p>
<ul>
<li>成功后，安装时添加持久化参数，其中 nfs-storage 为安装的 storageclass 的 provisioner 字段名字</li>
</ul>
<h2 id="7-安装-kubeAPPS-可视化软件管理工具"><a href="#7-安装-kubeAPPS-可视化软件管理工具" class="headerlink" title="7 安装 kubeAPPS 可视化软件管理工具"></a>7 安装 kubeAPPS 可视化软件管理工具</h2><p>参考：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://kubeapps.dev/docs/latest/tutorials/getting-started/"><strong>https://kubeapps.dev/docs/latest/tutorials/getting-started/</strong></a></p>
<ul>
<li>安装</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加 kubeapps 仓库</span></span><br><span class="line">helm repo add bitnami https://charts.bitnami.com/bitnami</span><br><span class="line"><span class="comment"># 创建 kubeapps 的命名空间</span></span><br><span class="line">kubectl create namespace kubeapps</span><br><span class="line"><span class="comment"># 安装</span></span><br><span class="line">helm install kubeapps --namespace kubeapps bitnami/kubeapps</span><br></pre></td></tr></table></figure>
<ul>
<li>创建证书</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建用于访问 Kubeapps 和 Kubernetes 的演示凭证</span></span><br><span class="line">kubectl create --namespace default serviceaccount kubeapps-operator</span><br><span class="line">kubectl create clusterrolebinding kubeapps-operator --clusterrole=cluster-admin --serviceaccount=default:kubeapps-operator</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF | kubectl apply -f -</span></span><br><span class="line"><span class="string">apiVersion: v1</span></span><br><span class="line"><span class="string">kind: Secret</span></span><br><span class="line"><span class="string">metadata:</span></span><br><span class="line"><span class="string">  name: kubeapps-operator-token</span></span><br><span class="line"><span class="string">  namespace: default</span></span><br><span class="line"><span class="string">  annotations:</span></span><br><span class="line"><span class="string">    kubernetes.io/service-account.name: kubeapps-operator</span></span><br><span class="line"><span class="string">type: kubernetes.io/service-account-token</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
<ul>
<li>查看令牌 token</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get --namespace default secret kubeapps-operator-token -o go-template=<span class="string">&#x27;&#123;&#123;.data.token | base64decode&#125;&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eyJhbGciOiJSUzI1NiIsImtpZCI6IkdVQTZzb3JEM1FHdkpxVDNsSEwtVEZWc2hyR08tbmFFWnFGX2Q2OGt5cEkifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJkZWZhdWx0Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZWNyZXQubmFtZSI6Imt1YmVhcHBzLW9wZXJhdG9yLXRva2VuIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6Imt1YmVhcHBzLW9wZXJhdG9yIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQudWlkIjoiNTNjY2M0N2YtZWFmMS00NDY4LWJkN2ItYTVhMzliMzJjMzExIiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50OmRlZmF1bHQ6a3ViZWFwcHMtb3BlcmF0b3IifQ.qsTBQODZLD1EUP5WjF_ju0-_ZFoJa2pEGCGf2zoLK71TjZeytD0GUGp4Z5ACNFuJMtedtx8tRgWhioU2oimxGdCIL4f7Szt0dOQgXD15HmoiUjYEcDQNsfTdcmfZw-m3-zwtTqa3kTTG3Wio0wf_f_ayw8qZCDL2i3PK-7h0QeAb1rQhtCz_e8huNrcshjixGlyw8aKUvdi2hPe6yvpxKJqQeOalNhT22b-ax28oIyqmC-NXYUMyRbEsgOjyuJAv6XdjqsQKbOGMKsTtNyf7CvnHl88hfRZpF0W-GuKj1ggKGYClTHuXnsv9QP-AQN1UaEtcAbUp08bHN9isedJL6w</span><br></pre></td></tr></table></figure>
<ul>
<li>修改服务模式，将其改为 NodePort</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 因为是测试环境，因此直接采用 NodePort 方式暴露服务端口</span></span><br><span class="line">kubectl edit svc kubeapps -n kubeapps</span><br></pre></td></tr></table></figure>
<ul>
<li>找到端口，在安全组放行</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get svc -A |grep kubeapps</span><br></pre></td></tr></table></figure>
<ul>
<li><font color='red'>访问</font>：<a target="_blank" rel="noopener external nofollow noreferrer" href="http://125.220.153.23:31885/">http://125.220.153.23:31885/</a></li>
</ul>
<h2 id="8-在-K8S-上部署虚拟机服务-Kubevirt"><a href="#8-在-K8S-上部署虚拟机服务-Kubevirt" class="headerlink" title="8 在 K8S 上部署虚拟机服务 Kubevirt"></a>8 在 K8S 上部署虚拟机服务 Kubevirt</h2><ul>
<li>设置 <strong>K8S</strong> <strong>ApiServer</strong> 允许特权容器</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/kubernetes/manifests/kube-apiserver.yaml</span><br><span class="line"><span class="comment"># 设置 </span></span><br><span class="line">--allow-privileged=<span class="literal">true</span></span><br></pre></td></tr></table></figure>
<ul>
<li>检查每个节点是否支持虚拟化</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">virt-host-validate qemu</span><br><span class="line"><span class="comment"># 如果显示没有这个命令，先安装 libvrt 和 qemu 软件包：</span></span><br><span class="line">yum install -y qemu-kvm libvirt virt-install bridge-utils</span><br></pre></td></tr></table></figure>
<ul>
<li>若有<strong>warnning</strong>，需要解决</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/binwenwu/picgo_demo/img/image-20230408181653957.png" alt="image-20230408181653957"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1</span></span><br><span class="line">vim /etc/default/grub</span><br><span class="line"><span class="comment"># 2.添加</span></span><br><span class="line">GRUB_CMDLINE_LINUX=<span class="string">&quot;crashkernel=auto rd.lvm.lv=centos/root rd.lvm.lv=centos/swap rhgb quiet intel_iommu=on&quot;</span></span><br><span class="line"><span class="comment"># 3 </span></span><br><span class="line">grub2-mkconfig -o /boot/grub2/grub.cfg</span><br><span class="line"><span class="comment"># 4 </span></span><br><span class="line">reboot</span><br></pre></td></tr></table></figure>
<ul>
<li>安装 <strong>Kubevirt</strong></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># K8S 1.25版本，Kubervirt必须0.57.2以上，才能适配</span></span><br><span class="line">kubectl apply -f https://github.com/kubevirt/kubevirt/releases/download/v0.58.0-rc.0/kubevirt-operator.yaml</span><br><span class="line"></span><br><span class="line">kubectl apply -f https://github.com/kubevirt/kubevirt/releases/download/v0.58.0-rc.0/kubevirt-cr.yaml</span><br></pre></td></tr></table></figure>
<ul>
<li>等待 <strong>Kubevirt</strong> 资源创建完毕</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl -n kubevirt <span class="built_in">wait</span> kv kubevirt --<span class="keyword">for</span> condition=Available</span><br></pre></td></tr></table></figure>
<ul>
<li>安装 <strong>CDI</strong> </li>
</ul>
<p><span style="color:red">参考</span>：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://kubevirt.io/labs/kubernetes/lab2.html">https://kubevirt.io/labs/kubernetes/lab2.html</a></p>
<ul>
<li>安装 <strong>VNC</strong></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y tigervnc</span><br></pre></td></tr></table></figure>
<ul>
<li>查看 <strong>Kubevirt</strong> 资源</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pods -n kubevirt</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/binwenwu/picgo_demo/img/image-20230408185646502.png" alt="image-20230408185646502"></p>
<ul>
<li>安装 <strong>Kubevirt</strong> 的 <strong>cli</strong> 管理工具</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl krew install virt</span><br><span class="line">kubectl virt <span class="built_in">help</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Kubevirt创建/删除虚拟机服务</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.	创建yaml文件</span></span><br><span class="line">Xxx</span><br><span class="line"><span class="comment"># 2.	运行一个虚拟机</span></span><br><span class="line">kubectl apply -f test.yaml</span><br><span class="line"><span class="comment"># 3.	查看虚拟机</span></span><br><span class="line">kubectl get vmis</span><br><span class="line"><span class="comment"># 4.	停止/删除虚拟机</span></span><br><span class="line">kubectl delete -f vmi.yaml</span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">kubectl delete vmis testvmi</span><br><span class="line"><span class="comment"># 5.	开始/停止/暂停虚拟机</span></span><br><span class="line">virtctl start/stop/pause my-vm</span><br></pre></td></tr></table></figure>
<h2 id="9-在-K8S-上部署-PostgreSQL"><a href="#9-在-K8S-上部署-PostgreSQL" class="headerlink" title="9 在 K8S 上部署 PostgreSQL"></a>9 在 K8S 上部署 PostgreSQL</h2><ul>
<li><p>安装</p>
<ul>
<li>注意：数据库安装需要持久卷，需提前创建满足要求的<strong>pv</strong>，或者创建<strong>nas</strong>的<strong>stroageclass</strong>，以自动根据<strong>mysql</strong>的<strong>pvc</strong>创建<strong>pv</strong>。</li>
</ul>
</li>
</ul>
<ul>
<li>集群已经配置23服务器的<code>/mnt/storage/k8s/pv</code>为NAS,并已经配置名字为<strong>nas-storage</strong>的<strong>sc</strong></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">helm repo add bitnami https://charts.bitnami.com/bitnami</span><br><span class="line"><span class="comment"># 首先检查是否有oge这个命名空间，否则执行如下进行创建</span></span><br><span class="line">kubectl create ns oge</span><br><span class="line"><span class="comment"># postgresql 这个名字可以自己定义，但后面每一步都要注意对应更改</span></span><br><span class="line">helm install -n oge  bitnami/postgresql \</span><br><span class="line">--<span class="built_in">set</span> global.storageClass=nfs-client \</span><br><span class="line">--<span class="built_in">set</span> readReplicas.persistence.storageClass=nfs-client \</span><br><span class="line">--<span class="built_in">set</span> primary.persistence.storageClass=nfs-client \</span><br><span class="line">--<span class="built_in">set</span> primary.persistence.size=200Gi \</span><br><span class="line">--<span class="built_in">set</span> readReplicas.persistence.size=200Gi \</span><br><span class="line">--<span class="built_in">set</span> image.tag=14.5.0-debian-11-r6</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">helm install -n geoctap  bitnami/postgresql \</span><br><span class="line">--<span class="built_in">set</span> global.storageClass=nfs-client \</span><br><span class="line">--<span class="built_in">set</span> readReplicas.persistence.storageClass=nfs-client \</span><br><span class="line">--<span class="built_in">set</span> primary.persistence.storageClass=nfs-client \</span><br><span class="line">--<span class="built_in">set</span> primary.persistence.size=200Gi \</span><br><span class="line">--<span class="built_in">set</span> readReplicas.persistence.size=200Gi \</span><br><span class="line">--<span class="built_in">set</span> image.tag=14.5.0-debian-11-r6</span><br><span class="line"><span class="comment"># 指定版本，可在kubeapps里面查看</span></span><br><span class="line"><span class="comment"># --set image.tag=14.5.0-debian-11-r6</span></span><br></pre></td></tr></table></figure>
<ul>
<li>查看 postgresql 密码</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl get secret --namespace oge postgresql -o jsonpath=<span class="string">&quot;&#123;.data.postgres-password&#125;&quot;</span> | <span class="built_in">base64</span> -d</span><br><span class="line"></span><br><span class="line"><span class="comment"># 密码</span></span><br><span class="line">7jXf2gsmUX</span><br></pre></td></tr></table></figure>
<ul>
<li>更改服务端口</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl edit svc --namespace oge postgresql</span><br><span class="line"><span class="comment"># 将 type=ClusterIP 改为 NodePort</span></span><br><span class="line"><span class="comment"># b8:85:84:71:64:28</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;SUBSYSTEM==\&quot;net\&quot;, ACTION==\&quot;add\&quot;, DRIVERS==\&quot;?*\&quot;, ATTR&#123;address&#125;==\&quot; b8:85:84:71:64:28\&quot;, ATTR&#123;type&#125;==\&quot;1\&quot;, KERNEL==\&quot;eno*\&quot;, NAME=\&quot;eno1\&quot;&quot;</span> &gt;&gt; /etc/udev/rules.d/70-persistent-net.rules</span><br></pre></td></tr></table></figure>
<ul>
<li>缩放副本集</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">kubectl get deployment </span><br><span class="line"><span class="comment"># 发现并没有postgresql</span></span><br><span class="line">kubectl get all -n oge</span><br><span class="line"><span class="comment"># 发现有statefulset.apps/postgresql</span></span><br><span class="line"><span class="comment"># 设置副本集个数为1</span></span><br><span class="line">kubectl scale --replicas=1 statefulset.apps/postgresql -n oge</span><br></pre></td></tr></table></figure>
<ul>
<li>命令行进入pgsql</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 进入pgsql的pod</span></span><br><span class="line">kubectl <span class="built_in">exec</span> -it -n oge postgresql-0 bash </span><br><span class="line"><span class="comment"># 用户登录</span></span><br><span class="line">psql -U postgres </span><br><span class="line"><span class="comment"># 输入密码</span></span><br><span class="line">7jXf2gsmUX</span><br></pre></td></tr></table></figure>
<ul>
<li>在pod外面执行sql</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">psql -h 125.220.153.23 -p 30865 -U postgres -W -f ./public.sql</span><br></pre></td></tr></table></figure>
<h2 id="10-在-K8S-上部署-MySQL"><a href="#10-在-K8S-上部署-MySQL" class="headerlink" title="10 在 K8S 上部署 MySQL"></a>10 在 K8S 上部署 MySQL</h2><ul>
<li><p>安装</p>
<ul>
<li><p>注意：数据库安装需要持久卷，需提前创建满足要求的<code>pv</code>，或者创建<code>nas</code>的 <code>stroageclass</code>，以自动根据postgresql的pvc创建pv。</p>
</li>
<li><p>集群已经配置23服务器的<code>/mnt/storage/k8s/pv</code>为 <code>NAS</code>,并已经配置名字为 <code>nas-storage</code> 的 <code>sc</code></p>
</li>
</ul>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">helm repo add bitnami https://charts.bitnami.com/bitnami</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装</span></span><br><span class="line">helm install -n oge mysql bitnami/mysql \</span><br><span class="line">--<span class="built_in">set</span> global.storageClass=nfs-client \</span><br><span class="line">--<span class="built_in">set</span> readReplicas.persistence.storageClass=nfs-client \</span><br><span class="line">--<span class="built_in">set</span> primary.persistence.storageClass=nfs-client \</span><br><span class="line">--<span class="built_in">set</span> primary.persistence.size=200Gi \</span><br><span class="line">--<span class="built_in">set</span> readReplicas.persistence.size=200Gi</span><br></pre></td></tr></table></figure>
<ul>
<li>查看 MySQL 密码</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl get secret --namespace oge mysql -o jsonpath=<span class="string">&quot;&#123;.data.mysql-root-password&#125;&quot;</span> | <span class="built_in">base64</span> -d</span><br><span class="line"></span><br><span class="line"><span class="comment"># 密码</span></span><br><span class="line">VubCMiHvT1</span><br></pre></td></tr></table></figure>
<ul>
<li>更改服务端口</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl edit svc --namespace oge mysql</span><br><span class="line"><span class="comment"># 将type=ClusterIP改为NodePort</span></span><br><span class="line"><span class="comment"># b8:85:84:71:64:28</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;SUBSYSTEM==\&quot;net\&quot;, ACTION==\&quot;add\&quot;, DRIVERS==\&quot;?*\&quot;, ATTR&#123;address&#125;==\&quot; b8:85:84:71:64:28\&quot;, ATTR&#123;type&#125;==\&quot;1\&quot;, KERNEL==\&quot;eno*\&quot;, NAME=\&quot;eno1\&quot;&quot;</span> &gt;&gt; /etc/udev/rules.d/70-persistent-net.rules</span><br></pre></td></tr></table></figure>
<ol>
<li>缩放副本集</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kubectl get deployment </span><br><span class="line"><span class="comment"># 发现并没有mysql</span></span><br><span class="line">kubectl get all -n oge</span><br><span class="line"><span class="comment"># 发现有statefulset.apps/mysql</span></span><br><span class="line">kubectl scale --replicas=1 statefulset.apps/mysql -n oge</span><br></pre></td></tr></table></figure>
<ol>
<li>在K8S中进入数据库</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl <span class="built_in">exec</span> -it -n oge mysql-1  bash</span><br><span class="line"><span class="comment"># 进入后登录用户</span></span><br><span class="line">mysql -u root -p</span><br><span class="line"><span class="comment"># 输入密码</span></span><br></pre></td></tr></table></figure>
<h2 id="11-在K8S上部署-MongoDB"><a href="#11-在K8S上部署-MongoDB" class="headerlink" title="11 在K8S上部署 MongoDB"></a>11 在K8S上部署 MongoDB</h2><ul>
<li><p>安装</p>
<ul>
<li><p>注意：数据库安装需要持久卷，需提前创建满足要求的pv，或者创建nas的stroageclass，以自动根据postgresql的pvc创建pv。</p>
</li>
<li><p>集群已经配置23服务器的<code>/mnt/storage/k8s/pv</code>为NAS,并已经配置名字为nas-storage的sc</p>
</li>
</ul>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">helm repo add bitnami https://charts.bitnami.com/bitnami</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装</span></span><br><span class="line">helm install -n ydy mongodb bitnami/mongodb \</span><br><span class="line">--<span class="built_in">set</span> global.storageClass=nfs-client \</span><br><span class="line">--<span class="built_in">set</span> readReplicas.persistence.storageClass=nfs-client \</span><br><span class="line">--<span class="built_in">set</span> primary.persistence.storageClass=nfs-client \</span><br><span class="line">--<span class="built_in">set</span> primary.persistence.size=100Gi \</span><br><span class="line">--<span class="built_in">set</span> readReplicas.persistence.size=100Gi</span><br></pre></td></tr></table></figure>
<ul>
<li>查看 MongoDB 密码</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl get secret --namespace ydy mongodb -o jsonpath=<span class="string">&quot;&#123;.data.mongodb-root-password&#125;&quot;</span> | <span class="built_in">base64</span> -d</span><br><span class="line"></span><br><span class="line"><span class="comment"># 密码</span></span><br><span class="line">WUL9FPQ2V9</span><br></pre></td></tr></table></figure>
<ul>
<li>更改服务端口</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl edit svc --namespace ydy mongodb</span><br><span class="line"><span class="comment"># 将type=ClusterIP改为NodePort</span></span><br><span class="line"><span class="comment"># b8:85:84:71:64:28</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;SUBSYSTEM==\&quot;net\&quot;, ACTION==\&quot;add\&quot;, DRIVERS==\&quot;?*\&quot;, ATTR&#123;address&#125;==\&quot; b8:85:84:71:64:28\&quot;, ATTR&#123;type&#125;==\&quot;1\&quot;, KERNEL==\&quot;eno*\&quot;, NAME=\&quot;eno1\&quot;&quot;</span> &gt;&gt; /etc/udev/rules.d/70-persistent-net.rules</span><br></pre></td></tr></table></figure>
<ol>
<li>缩放副本集</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kubectl get deployment </span><br><span class="line"><span class="comment"># 发现并没有mongodb</span></span><br><span class="line">kubectl get all -n ydy</span><br><span class="line"><span class="comment"># 发现有statefulset.apps/mongodb</span></span><br><span class="line">kubectl scale --replicas=1 statefulset.apps/mongodb -n ydy</span><br></pre></td></tr></table></figure>
<ol>
<li>在K8S中进入数据库</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl <span class="built_in">exec</span> -it -n ydy mongodb-644c657c4f-x62cn bash</span><br></pre></td></tr></table></figure>
<h2 id="12-在-K8S-上部署-Apache-Spark"><a href="#12-在-K8S-上部署-Apache-Spark" class="headerlink" title="12 在 K8S 上部署 Apache Spark"></a>12 在 K8S 上部署 Apache Spark</h2><p>两个方式，第一种方式为Spark官方提出的；第二种为Google提出的，更符合K8S原生概念</p>
<ol>
<li>Spark On K8S</li>
<li>spark-on-k8s-operator</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/binwenwu/picgo_demo/img/image-20230408170401365.png" alt="image-20230408170401365"></p>
<center>Spark On K8S</center>

<p><img src="https://cdn.jsdelivr.net/gh/binwenwu/picgo_demo/img/image-20230408170444023.png" alt="image-20230408170444023"></p>
<center>spark-on-k8s-operator</center>



<h3 id="12-1-安装-spark-on-k8s-operator"><a href="#12-1-安装-spark-on-k8s-operator" class="headerlink" title="12.1 安装 spark-on-k8s-operator "></a>12.1 <font color='black'>安装 spark-on-k8s-operator </font></h3><p><span style="color:red">参考 </span>：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/w8998036/article/details/122217230">https://blog.csdn.net/w8998036/article/details/122217230</a></p>
<ul>
<li>安装</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">helm repo add spark-operator https://googlecloudplatform.github.io/spark-on-k8s-operator </span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意是否存在 spark-operator 命名空间，没有则创建</span></span><br><span class="line">kubectl create ns spark-operator</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装</span></span><br><span class="line">helm install spark-operator spark-operator/spark-operator --namespace spark-operator  --<span class="built_in">set</span> sparkJobNamespace=default  --<span class="built_in">set</span> webhook.enable=<span class="literal">true</span></span><br></pre></td></tr></table></figure>
<ul>
<li>创建服务账户</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim spark-application-rbac.yaml</span><br><span class="line"><span class="comment"># 内容如下</span></span><br></pre></td></tr></table></figure>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">spark</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">spark</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Role</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">spark</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">spark-role</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">  <span class="attr">resources:</span> [<span class="string">&quot;pods&quot;</span>]</span><br><span class="line">  <span class="attr">verbs:</span> [<span class="string">&quot;*&quot;</span>]</span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">  <span class="attr">resources:</span> [<span class="string">&quot;services&quot;</span>]</span><br><span class="line">  <span class="attr">verbs:</span> [<span class="string">&quot;*&quot;</span>]</span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">RoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">spark-role-binding</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">spark</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">spark</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">spark</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">Role</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">spark-role</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create clusterrolebinding root-cluster-admin-binding --clusterrole=cluster-admin --user=root</span><br></pre></td></tr></table></figure>
<ul>
<li>编写作业模板并提交作业</li>
</ul>
<p><em>创建一个Spark作业的YAML配置文件，并进行部署。</em></p>
<ol>
<li>创建spark-pi.yaml文件</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">&quot;sparkoperator.k8s.io/v1beta2&quot;</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">SparkApplication</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">spark-pi</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">spark</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">Scala</span></span><br><span class="line">  <span class="attr">mode:</span> <span class="string">cluster</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">&quot;registry.cn-hangzhou.aliyuncs.com/yudayu/spark:v3.1.1&quot;</span>  </span><br><span class="line">  <span class="comment"># 1gcr.io/spark-operator/spark:v3.1.1需要更换镜像，gcr.io目前国内无法访问。可以先对docker挂代理，pull到阿里云镜像后</span></span><br><span class="line">  <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">  <span class="attr">mainClass:</span> <span class="string">org.apache.spark.examples.SparkPi</span></span><br><span class="line">  <span class="attr">mainApplicationFile:</span> <span class="string">&quot;local:///opt/spark/examples/jars/spark-examples_2.12-3.1.1.jar&quot;</span>    </span><br><span class="line">  <span class="comment"># 需要更换自己的jar包，local指该jar位于image内，可换成所有节点都能访问的web路径，或者通过指定nas挂载pv，将jar包放在nas的pv里</span></span><br><span class="line">  <span class="attr">sparkVersion:</span> <span class="string">&quot;3.1.1&quot;</span></span><br><span class="line">  <span class="attr">restartPolicy:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">Never</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&quot;test-volume&quot;</span></span><br><span class="line">      <span class="attr">hostPath:</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">&quot;/tmp&quot;</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">Directory</span></span><br><span class="line">  <span class="attr">driver:</span></span><br><span class="line">    <span class="attr">cores:</span> <span class="number">1</span></span><br><span class="line">    <span class="attr">coreLimit:</span> <span class="string">&quot;1200m&quot;</span></span><br><span class="line">    <span class="attr">memory:</span> <span class="string">&quot;512m&quot;</span></span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">version:</span> <span class="number">3.1</span><span class="number">.1</span></span><br><span class="line">    <span class="attr">serviceAccount:</span> <span class="string">spark</span></span><br><span class="line">    <span class="attr">volumeMounts:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&quot;test-volume&quot;</span></span><br><span class="line">        <span class="attr">mountPath:</span> <span class="string">&quot;/tmp&quot;</span></span><br><span class="line">  <span class="attr">executor:</span></span><br><span class="line">    <span class="attr">cores:</span> <span class="number">1</span></span><br><span class="line">    <span class="attr">instances:</span> <span class="number">2</span></span><br><span class="line">    <span class="attr">memory:</span> <span class="string">&quot;512m&quot;</span></span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">version:</span> <span class="number">3.1</span><span class="number">.1</span></span><br><span class="line">    <span class="attr">volumeMounts:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&quot;test-volume&quot;</span></span><br><span class="line">        <span class="attr">mountPath:</span> <span class="string">&quot;/tmp&quot;</span></span><br></pre></td></tr></table></figure>
<ol>
<li>部署一个Spark计算任务</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f spark-pi.yaml</span><br></pre></td></tr></table></figure>
<p>运维</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl get sparkapplications</span><br><span class="line">kubectl describe sparkapplications</span><br><span class="line">kubectl get svc  <span class="comment"># 查看该任务的spark ui</span></span><br></pre></td></tr></table></figure>
<h3 id="12-2-安装-Spark-On-K8S"><a href="#12-2-安装-Spark-On-K8S" class="headerlink" title="12.2 安装  Spark On K8S"></a>12.2 <font color='black'>安装  Spark On K8S</font></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">helm repo add bitnami https://charts.bitnami.com/bitnami</span><br><span class="line"><span class="comment"># 注意是否存在 spark-operator 命名空间，没有则创建</span></span><br><span class="line">kubectl create ns spark-on-k8s</span><br><span class="line">helm install -n spark-on-k8s spark bitnami/spark \</span><br><span class="line">  --<span class="built_in">set</span> worker.coreLimit=28 </span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">./bin/spark-submit    \</span><br><span class="line">    --class org.apache.spark.examples.SparkPi \</span><br><span class="line">    --conf spark.kubernetes.container.image=bitnami/spark:3 \</span><br><span class="line">    --master k8s://https://125.220.153.23:6443 \</span><br><span class="line">    --conf spark.kubernetes.driverEnv.SPARK_MASTER_URL=spark://10.97.43.141:7077  \</span><br><span class="line">--deploy-mode cluster \</span><br><span class="line">  --executor-memory 20G \</span><br><span class="line">  --num-executors 10 \</span><br><span class="line">--conf spark.executor.instances=5 \</span><br><span class="line">https:///data/spark-examples_2.12-3.3.0.jar 1000</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">kubectl run --namespace spark-on-k8s spark-oge --<span class="built_in">rm</span> --<span class="built_in">tty</span> -i --restart=<span class="string">&#x27;Never&#x27;</span> \</span><br><span class="line">--image bitnami/spark:3 \</span><br><span class="line">-- spark-submit --master spark://10.97.43.141:7077 \</span><br><span class="line">--class org.apache.spark.examples.SparkPi \</span><br><span class="line">    --deploy-mode cluster \</span><br><span class="line">/data/spark-examples_2.12-3.3.0.jar 100000</span><br></pre></td></tr></table></figure>
<h2 id="13-在K8S上部署redis集群"><a href="#13-在K8S上部署redis集群" class="headerlink" title="13 在K8S上部署redis集群"></a>13 在K8S上部署redis集群</h2><ul>
<li>待更</li>
</ul>
<h2 id="14-在K8S上部署nginx"><a href="#14-在K8S上部署nginx" class="headerlink" title="14 在K8S上部署nginx"></a>14 在K8S上部署nginx</h2><h3 id="14-1-创建pv"><a href="#14-1-创建pv" class="headerlink" title="14.1 创建pv"></a>14.1 创建pv</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim nginx-pv.yaml</span><br></pre></td></tr></table></figure>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolume</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-ydy-pv</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ydy</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">capacity:</span></span><br><span class="line">    <span class="attr">storage:</span> <span class="string">10Gi</span></span><br><span class="line">  <span class="attr">accessModes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ReadWriteOnce</span></span><br><span class="line">  <span class="attr">persistentVolumeReclaimPolicy:</span> <span class="string">Retain</span></span><br><span class="line">  <span class="attr">storageClassName:</span> <span class="string">manual</span></span><br><span class="line">  <span class="attr">hostPath:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/mnt/storage/k8s/pv/ydy-nginx-pvc</span></span><br></pre></td></tr></table></figure>
<h3 id="14-2-创建pvc"><a href="#14-2-创建pvc" class="headerlink" title="14.2 创建pvc"></a>14.2 创建pvc</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim nginx-pvc.yaml</span><br></pre></td></tr></table></figure>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolumeClaim</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-ydy-pvc</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ydy</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">accessModes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ReadWriteOnce</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">    <span class="attr">requests:</span></span><br><span class="line">      <span class="attr">storage:</span> <span class="string">10Gi</span></span><br><span class="line">  <span class="attr">storageClassName:</span> <span class="string">manual</span></span><br></pre></td></tr></table></figure>
<h3 id="14-3-安装nginx并设置静态资源挂载的pvc"><a href="#14-3-安装nginx并设置静态资源挂载的pvc" class="headerlink" title="14.3 安装nginx并设置静态资源挂载的pvc"></a>14.3 安装nginx并设置静态资源挂载的pvc</h3><p>将nginx中的<code>/app</code>挂载到<code>/mnt/storage/k8s/pv/luluancheng-nginx-pvc</code>下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">helm install -n ydy nginx bitnami/nginx \</span><br><span class="line">--<span class="built_in">set</span> staticSitePVC=nginx-ydy-pvc</span><br></pre></td></tr></table></figure>
<h2 id="附录：疑难问题解决："><a href="#附录：疑难问题解决：" class="headerlink" title="附录：疑难问题解决："></a>附录：疑难问题解决：</h2><h3 id="1-K8S强制删除-namespace（会删除该命名空间中的所有-pod-）"><a href="#1-K8S强制删除-namespace（会删除该命名空间中的所有-pod-）" class="headerlink" title="1 K8S强制删除 namespace（会删除该命名空间中的所有 pod ）"></a>1 K8S强制删除 namespace（会删除该命名空间中的所有 pod ）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1、将该分区导出为json文件，以 oge namespace为例</span></span><br><span class="line">kubectl get ns oge -o json &gt; oge.json</span><br><span class="line"><span class="comment">#2、编辑该json文件，将spec内的内容全部删除，然后保存退出</span></span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/binwenwu/picgo_demo/img/22f0a5cbf0424425b0d62681f79cb713.png" alt="22f0a5cbf0424425b0d62681f79cb713"></p>
<p><img src="https://cdn.jsdelivr.net/gh/binwenwu/picgo_demo/img/ef949b8bb503410c918894ab20bad993.png" alt="ef949b8bb503410c918894ab20bad993"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 3、另开一个终端，启动一个proxy</span></span><br><span class="line">kubectl proxy --port=8081</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 4、执行一个curl命令，更新oge namespace</span></span><br><span class="line">curl -k -H <span class="string">&quot;Content-Type: application/json&quot;</span> -X PUT --data-binary @oge.json http://127.0.0.1:8081/api/v1/namespaces/oge/finalize</span><br></pre></td></tr></table></figure>
<h3 id="2-CNI网络错误"><a href="#2-CNI网络错误" class="headerlink" title="2 CNI网络错误"></a>2 CNI网络错误</h3><ul>
<li>当迁移集群之后，拉取镜像报cni网络错误，如下：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/binwenwu/picgo_demo/img/8d5d49703c8ac59f24fde81b3982b616.png" alt="8d5d49703c8ac59f24fde81b3982b616"></p>
<ul>
<li>从上面的截图中看到问题出现在给Pod分配IP上，意思是 cni0 的IP不同于<code>`10.244.9.1/24</code>，下面我们使用  <code>ifconfig</code>命令查看IP信息</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/binwenwu/picgo_demo/img/79e65e4f797200ad98feac6f8b2d4254.png" alt="79e65e4f797200ad98feac6f8b2d4254"></p>
<ul>
<li>从上面的图中我们可以看到<code>`flannel.1</code>的 <strong>IP</strong> 为<code>10.244.9.0</code>，然后我们又使用<code>cat /run/flannel/subnet.env</code>，该文件内容如下：  </li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/binwenwu/picgo_demo/img/310efbdb614636a17aa48eaf4a8dc2c5.png" alt="310efbdb614636a17aa48eaf4a8dc2c5"></p>
<ul>
<li><p>其实现在的问题就比较明确了，我们使用的Overlay network为Flannel，也就是说Pod的IP地址段应该在Flannel的subnet下，而现在我们看到cni0的IP地址段与flannel subnet地址段不同，所以就出现了问题。  </p>
</li>
<li><p>解决方案</p>
<ul>
<li>方法1是将 cni0 的 IP 段修改为<code>`10.244.9.1</code></li>
<li>方法2是将这个错误的网卡删除掉，之后会自动重建</li>
</ul>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下面我们删除错误的cni0，然后让它自己重建</span></span><br><span class="line">ifconfig cni0 down</span><br><span class="line">ip <span class="built_in">link</span> delete cni0</span><br></pre></td></tr></table></figure>
<h3 id="3-28-服务器增加路由（为了让两台刀片上网）"><a href="#3-28-服务器增加路由（为了让两台刀片上网）" class="headerlink" title="3 28 服务器增加路由（为了让两台刀片上网）"></a>3 28 服务器增加路由（为了让两台刀片上网）</h3><ul>
<li>28上执行</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iptables -t nat -A POSTROUTING -s 192.168.0.209/24 -o em1_2 -j MASQUERADE</span><br><span class="line">iptables -t nat -A POSTROUTING -s 192.168.0.177/24 -o em1_2 -j MASQUERADE</span><br></pre></td></tr></table></figure>
<h3 id="4-异常断电等导致-etcd-心跳检测出现问题"><a href="#4-异常断电等导致-etcd-心跳检测出现问题" class="headerlink" title="4 异常断电等导致 etcd 心跳检测出现问题"></a>4 异常断电等导致 etcd 心跳检测出现问题</h3><ul>
<li><p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/kubernetes/kubernetes/issues/107491">Kubernetes API Server cannot be started after improper reboot</a></p>
</li>
<li><p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.51cto.com/liruilong/6060676">K8S: etcd 集群备份灾难恢复操作手册</a></p>
</li>
</ul>
<h3 id="5-OpenStack服务器网络跳转镜像"><a href="#5-OpenStack服务器网络跳转镜像" class="headerlink" title="5 OpenStack服务器网络跳转镜像"></a>5 OpenStack服务器网络跳转镜像</h3><blockquote>
<p>作用: 保证OpenStack上服务器与实验室服务器可以 ping 通</p>
</blockquote>
<ul>
<li><strong>IP</strong><ul>
<li><code>115.156.91.250</code></li>
</ul>
</li>
<li><strong>网关</strong><ul>
<li><code>115.156.91.254</code></li>
</ul>
</li>
<li><strong>子网掩码</strong><ul>
<li><code>255.255.255.0</code></li>
</ul>
</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://binwenwu.github.io">贪肯奇</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://binwenwu.github.io/archives/9d39de82.html">https://binwenwu.github.io/archives/9d39de82.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://binwenwu.github.io" target="_blank">TANKENQI</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/K8S/">K8S</a><a class="post-meta__tags" href="/tags/Containerd/">Containerd</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/binwenwu/picgo_demo/img/u%3D2793533854%2C2733450472%26fm%3D253%26fmt%3Dauto%26app%3D138%26f%3DJPEG" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div><form id="follow" action="https://api.follow.it/subscribe?pub=v3FnyZzIYSKVaQVvMI8Ki4XoIQrvEC0- " method="post" target="_blank"><div class="follow-it-form-subscribe" style="position: relative;"><div class="heading"><h5 style="font-weight: bold; text-align: center;">订阅本站文章：</h5></div><div class="input-field"><input type="email" name="email" placeholder="填入您的邮箱地址" spellcheck="false"></div><div class="submit-button"><button type="submit" onclick="ga('send','event', 'Form','Submit','Affiliate');" style="font-weight: bold; font-size: 14px; text-align: center;">确认订阅</button></div></div></form></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://github.com/binwenwu/blog/blob/main/source/img/wechat.png?raw=true" rel="external nofollow noreferrer" target="_blank"><img class="post-qr-code-img" src="https://github.com/binwenwu/blog/blob/main/source/img/wechat.png?raw=true" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://github.com/binwenwu/blog/blob/main/source/img/alipay.png?raw=true" rel="external nofollow noreferrer" target="_blank"><img class="post-qr-code-img" src="https://github.com/binwenwu/blog/blob/main/source/img/alipay.png?raw=true" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/archives/557acb69.html" title="Linux上Pandoc的使用"><img class="cover" src="https://cdn.jsdelivr.net/gh/binwenwu/picgo_demo/img/QQ%E6%88%AA%E5%9B%BE20230819015436.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Linux上Pandoc的使用</div></div></a></div><div class="next-post pull-right"><a href="/archives/7ddf46fc.html" title="VMware安装CentOS 7"><img class="cover" src="https://cdn.jsdelivr.net/gh/binwenwu/picgo_demo/img/u%3D3933667462%2C2332434810%26fm%3D253%26fmt%3Dauto%26app%3D138%26f%3DJPEG" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">VMware安装CentOS 7</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/archives/d862c611.html" title="K8S集群环境搭建(Docker作为容器)"><img class="cover" src="https://cdn.jsdelivr.net/gh/binwenwu/picgo_demo/img/u%3D2075113303%2C1509195472%26fm%3D253%26fmt%3Dauto%26app%3D138%26f%3DJPG" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-05-18</div><div class="title">K8S集群环境搭建(Docker作为容器)</div></div></a></div></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div><div class="comment-barrage"></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://cdn.jsdelivr.net/gh/binwenwu/picgo_demo/img/c933509f3fcc721e6f8e8612f7ec8725.jpeg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">贪肯奇</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">14</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">22</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><a id="card-info-btn" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/binwenwu"><i class="fab fa-github"></i><span>关注我</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/binwenwu" rel="external nofollow noreferrer" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:binwenwu598@gmail.com" rel="external nofollow noreferrer" target="_blank" title="Gmail"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a><a class="social-icon" href="https://res.abeim.cn/api/qq/?qq=2390726421" rel="external nofollow noreferrer" target="_blank" title="QQ"><i class="fa-brands fa-qq" style="color: #24292e;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来到贪肯奇的博客</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%89%8D%E8%BF%B0"><span class="toc-text">1 前述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E4%BA%91%E5%8E%9F%E7%94%9F%E5%AE%9A%E4%B9%89"><span class="toc-text">1.1 云原生定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E5%AE%B9%E5%99%A8%E3%80%81%E8%99%9A%E6%8B%9F%E6%9C%BA%E3%80%81Docker%E3%80%81Openstack-%E5%92%8C-K8S"><span class="toc-text">1.2 容器、虚拟机、Docker、Openstack 和 K8S</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-K8S-%E5%92%8C-%E4%BA%91%E5%8E%9F%E7%94%9F"><span class="toc-text">1.3 K8S 和 云原生</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-K8S-%E4%BB%8B%E7%BB%8D"><span class="toc-text">1.4 K8S 介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-text">1.5 基本概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-6-K8S-%E5%B8%B8%E8%A7%81%E5%91%BD%E4%BB%A4"><span class="toc-text">1.6 K8S 常见命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-7-K8S-%E5%B8%B8%E7%94%A8%E8%BF%90%E7%BB%B4%E5%91%BD%E4%BB%A4"><span class="toc-text">1.7 K8S 常用运维命令</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-K8S-%E9%9B%86%E7%BE%A4%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2"><span class="toc-text">2 K8S 集群基础环境部署</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-text">2.1 服务器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E5%AE%89%E8%A3%85%E8%BF%87%E7%A8%8B"><span class="toc-text">2.2 安装过程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-1-%E5%89%8D%E6%8F%90%E6%9D%A1%E4%BB%B6"><span class="toc-text">2.2.1 前提条件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-2-%E5%8D%87%E7%BA%A7-Linux-%E5%86%85%E6%A0%B8%E5%88%B0%E6%9C%80%E6%96%B0%EF%BC%88%E6%89%80%E6%9C%89%E8%8A%82%E7%82%B9%EF%BC%89%EF%BC%9A"><span class="toc-text">2.2.2 升级 Linux 内核到最新（所有节点）：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-3-%E8%BD%AC%E5%8F%91-IPv4-%E5%B9%B6%E8%AE%A9-iptables-%E7%9C%8B%E5%88%B0%E6%A1%A5%E6%8E%A5%E6%B5%81%E9%87%8F%EF%BC%88%E6%89%80%E6%9C%89%E8%8A%82%E7%82%B9%EF%BC%89"><span class="toc-text">2.2.3 转发 IPv4 并让 iptables 看到桥接流量（所有节点）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-4-%E5%AE%89%E8%A3%85-ipvsadm%EF%BC%88%E6%89%80%E6%9C%89%E8%8A%82%E7%82%B9%EF%BC%89"><span class="toc-text">2.2.4  安装 ipvsadm（所有节点）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-5-%E4%BF%AE%E6%94%B9%E5%86%85%E6%A0%B8%E5%8F%82%E6%95%B0%EF%BC%88%E6%89%80%E6%9C%89%E8%8A%82%E7%82%B9%EF%BC%8Clb%E9%99%A4%E5%A4%96%EF%BC%89"><span class="toc-text">2.2.5 修改内核参数（所有节点，lb除外）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-6-%E5%AE%89%E8%A3%85Container-Runtime-%E9%80%89%E7%94%A8containerd-%E5%BC%83%E7%94%A8docker-%EF%BC%9A"><span class="toc-text">2.2.6 安装Container Runtime(选用containerd,弃用docker)：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-7-%E5%9C%A8%E6%89%80%E6%9C%89%E7%94%B5%E8%84%91%E4%B8%8A%E5%AE%89%E8%A3%85-kubeadm-kubelet-and-kubectl%EF%BC%88%E6%89%80%E6%9C%89%E8%8A%82%E7%82%B9%EF%BC%89"><span class="toc-text">2.2.7 在所有电脑上安装 kubeadm, kubelet and kubectl（所有节点）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-8-%E5%90%AF%E5%8A%A8%E6%8E%A7%E5%88%B6%E9%9D%A2%E8%8A%82%E7%82%B9"><span class="toc-text">2.2.8 启动控制面节点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-9-%E9%85%8D%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F-%E5%88%9D%E5%A7%8B%E5%8C%96%E5%90%8E"><span class="toc-text">2.2.9 配置环境变量(初始化后)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-10-%E5%B0%86-master-%E4%BD%9C%E4%B8%BAnode%EF%BC%88%E7%AE%A1%E7%90%86%E8%8A%82%E7%82%B9%E4%B8%8A%E6%89%A7%E8%A1%8C%EF%BC%89"><span class="toc-text">2.2.10 将 master 作为node（管理节点上执行）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-11-%E5%AE%89%E8%A3%85-Pod-%E7%BD%91%E7%BB%9C%E6%8F%92%E4%BB%B6%EF%BC%88CNI%EF%BC%9AContainer-Network-Interface%EF%BC%89-master"><span class="toc-text">2.2.11 安装 Pod 网络插件（CNI：Container Network Interface）(master)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-12-node-%E8%8A%82%E7%82%B9%E5%8A%A0%E5%85%A5%E9%9B%86%E7%BE%A4"><span class="toc-text">2.2.12 node 节点加入集群</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-13-%E6%B7%BB%E5%8A%A0%E6%96%B0%E7%9A%84-master-%E8%8A%82%E7%82%B9"><span class="toc-text">2.2.13 添加新的 master 节点</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-K8S-%E7%AE%A1%E7%90%86%E5%B9%B3%E5%8F%B0-dashboard-%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%EF%BC%88%E7%AE%A1%E7%90%86%E8%8A%82%E7%82%B9%EF%BC%89"><span class="toc-text">3 K8S 管理平台 dashboard 环境部署（管理节点）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E5%AE%89%E8%A3%85K8S%E7%9A%84%E5%8C%85%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7Helm-%EF%BC%88%E7%AE%A1%E7%90%86%E8%8A%82%E7%82%B9%EF%BC%89"><span class="toc-text">4 安装K8S的包管理工具Helm （管理节点）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E5%AE%89%E8%A3%85K8S%E7%9A%84%E5%8C%85%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7-krew%EF%BC%88%E7%AE%A1%E7%90%86%E8%8A%82%E7%82%B9%EF%BC%89"><span class="toc-text">5 安装K8S的包管理工具 krew（管理节点）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E4%B8%BA-K8S-%E5%88%9B%E5%BB%BA-PV-%E6%8C%81%E4%B9%85%E5%8D%B7"><span class="toc-text">6 为 K8S 创建 PV 持久卷</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-PV%E5%92%8CPVC"><span class="toc-text">6.1 PV和PVC</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-%E7%94%A8-storageClass-%E5%8A%A8%E6%80%81%E5%88%9B%E5%BB%BA-PV"><span class="toc-text">6.2 用 storageClass 动态创建 PV</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E5%AE%89%E8%A3%85-kubeAPPS-%E5%8F%AF%E8%A7%86%E5%8C%96%E8%BD%AF%E4%BB%B6%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7"><span class="toc-text">7 安装 kubeAPPS 可视化软件管理工具</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E5%9C%A8-K8S-%E4%B8%8A%E9%83%A8%E7%BD%B2%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%9C%8D%E5%8A%A1-Kubevirt"><span class="toc-text">8 在 K8S 上部署虚拟机服务 Kubevirt</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-%E5%9C%A8-K8S-%E4%B8%8A%E9%83%A8%E7%BD%B2-PostgreSQL"><span class="toc-text">9 在 K8S 上部署 PostgreSQL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-%E5%9C%A8-K8S-%E4%B8%8A%E9%83%A8%E7%BD%B2-MySQL"><span class="toc-text">10 在 K8S 上部署 MySQL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-%E5%9C%A8K8S%E4%B8%8A%E9%83%A8%E7%BD%B2-MongoDB"><span class="toc-text">11 在K8S上部署 MongoDB</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-%E5%9C%A8-K8S-%E4%B8%8A%E9%83%A8%E7%BD%B2-Apache-Spark"><span class="toc-text">12 在 K8S 上部署 Apache Spark</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#12-1-%E5%AE%89%E8%A3%85-spark-on-k8s-operator"><span class="toc-text">12.1 安装 spark-on-k8s-operator </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-2-%E5%AE%89%E8%A3%85-Spark-On-K8S"><span class="toc-text">12.2 安装  Spark On K8S</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-%E5%9C%A8K8S%E4%B8%8A%E9%83%A8%E7%BD%B2redis%E9%9B%86%E7%BE%A4"><span class="toc-text">13 在K8S上部署redis集群</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-%E5%9C%A8K8S%E4%B8%8A%E9%83%A8%E7%BD%B2nginx"><span class="toc-text">14 在K8S上部署nginx</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#14-1-%E5%88%9B%E5%BB%BApv"><span class="toc-text">14.1 创建pv</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-2-%E5%88%9B%E5%BB%BApvc"><span class="toc-text">14.2 创建pvc</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-3-%E5%AE%89%E8%A3%85nginx%E5%B9%B6%E8%AE%BE%E7%BD%AE%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E6%8C%82%E8%BD%BD%E7%9A%84pvc"><span class="toc-text">14.3 安装nginx并设置静态资源挂载的pvc</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%99%84%E5%BD%95%EF%BC%9A%E7%96%91%E9%9A%BE%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%EF%BC%9A"><span class="toc-text">附录：疑难问题解决：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-K8S%E5%BC%BA%E5%88%B6%E5%88%A0%E9%99%A4-namespace%EF%BC%88%E4%BC%9A%E5%88%A0%E9%99%A4%E8%AF%A5%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E4%B8%AD%E7%9A%84%E6%89%80%E6%9C%89-pod-%EF%BC%89"><span class="toc-text">1 K8S强制删除 namespace（会删除该命名空间中的所有 pod ）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-CNI%E7%BD%91%E7%BB%9C%E9%94%99%E8%AF%AF"><span class="toc-text">2 CNI网络错误</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-28-%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%A2%9E%E5%8A%A0%E8%B7%AF%E7%94%B1%EF%BC%88%E4%B8%BA%E4%BA%86%E8%AE%A9%E4%B8%A4%E5%8F%B0%E5%88%80%E7%89%87%E4%B8%8A%E7%BD%91%EF%BC%89"><span class="toc-text">3 28 服务器增加路由（为了让两台刀片上网）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%BC%82%E5%B8%B8%E6%96%AD%E7%94%B5%E7%AD%89%E5%AF%BC%E8%87%B4-etcd-%E5%BF%83%E8%B7%B3%E6%A3%80%E6%B5%8B%E5%87%BA%E7%8E%B0%E9%97%AE%E9%A2%98"><span class="toc-text">4 异常断电等导致 etcd 心跳检测出现问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-OpenStack%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BD%91%E7%BB%9C%E8%B7%B3%E8%BD%AC%E9%95%9C%E5%83%8F"><span class="toc-text">5 OpenStack服务器网络跳转镜像</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/archives/33834cc9.html" title="武汉大学微软社招新2023笔试题"><img src="https://cdn.jsdelivr.net/gh/binwenwu/picgo_demo/img/%E7%BC%96%E7%A8%8B.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="武汉大学微软社招新2023笔试题"/></a><div class="content"><a class="title" href="/archives/33834cc9.html" title="武汉大学微软社招新2023笔试题">武汉大学微软社招新2023笔试题</a><time datetime="2023-08-13T17:50:45.000Z" title="发表于 2023-08-14 01:50:45">2023-08-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/archives/aec1e412.html" title="Vue子组件中调用父组件中的方法"><img src="https://cdn.jsdelivr.net/gh/binwenwu/picgo_demo/img/u%3D702715071%2C3690882623%26fm%3D253%26fmt%3Dauto%26app%3D138%26f%3DJPEG" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Vue子组件中调用父组件中的方法"/></a><div class="content"><a class="title" href="/archives/aec1e412.html" title="Vue子组件中调用父组件中的方法">Vue子组件中调用父组件中的方法</a><time datetime="2023-08-12T09:59:05.000Z" title="发表于 2023-08-12 17:59:05">2023-08-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/archives/2de821dc.html" title="Linux 系统字体安装"><img src="https://cdn.jsdelivr.net/gh/binwenwu/picgo_demo/img/u%3D3057738919%2C1244255327%26fm%3D253%26fmt%3Dauto%26app%3D138%26f%3DJPEG" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Linux 系统字体安装"/></a><div class="content"><a class="title" href="/archives/2de821dc.html" title="Linux 系统字体安装">Linux 系统字体安装</a><time datetime="2023-08-09T11:48:15.000Z" title="发表于 2023-08-09 19:48:15">2023-08-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/archives/557acb69.html" title="Linux上Pandoc的使用"><img src="https://cdn.jsdelivr.net/gh/binwenwu/picgo_demo/img/QQ%E6%88%AA%E5%9B%BE20230819015436.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Linux上Pandoc的使用"/></a><div class="content"><a class="title" href="/archives/557acb69.html" title="Linux上Pandoc的使用">Linux上Pandoc的使用</a><time datetime="2023-08-09T10:25:15.000Z" title="发表于 2023-08-09 18:25:15">2023-08-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/archives/9d39de82.html" title="K8S集群环境搭建(Containerd作为容器)"><img src="https://cdn.jsdelivr.net/gh/binwenwu/picgo_demo/img/u%3D2793533854%2C2733450472%26fm%3D253%26fmt%3Dauto%26app%3D138%26f%3DJPEG" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="K8S集群环境搭建(Containerd作为容器)"/></a><div class="content"><a class="title" href="/archives/9d39de82.html" title="K8S集群环境搭建(Containerd作为容器)">K8S集群环境搭建(Containerd作为容器)</a><time datetime="2023-08-06T07:08:12.000Z" title="发表于 2023-08-06 15:08:12">2023-08-06</time></div></div></div></div></div></div></main><footer id="footer" style="background: transparent"><div id="footer-wrap"><div class="copyright">&copy;2022 - 2023 By 贪肯奇</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><!-- - const showArray = enable ? show && show.split(',') : ['toc','chat','comment']--><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><a id="switch_commentBarrage" href="javascript:switchCommentBarrage();" rel="external nofollow noreferrer" title="开关弹幕"><i class="iconfont icon-danmu"></i></a><button id="translateLink" type="button" title="简繁转换">簡</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button><button class="share" type="button" title="分享链接" onclick="share()"><i class="fas fa-share-nodes"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button><button id="go-down" type="button" title="直达底部" onclick="btf.scrollToDest(document.body.scrollHeight, 500)"><i class="fas fa-arrow-down"></i></button></div></div><div class="js-pjax" id="rightMenu"><div class="rightMenu-group rightMenu-small"><a class="rightMenu-item" href="javascript:window.history.back();" rel="external nofollow noreferrer"><i class="fa fa-arrow-left"></i></a><a class="rightMenu-item" href="javascript:window.history.forward();" rel="external nofollow noreferrer"><i class="fa fa-arrow-right"></i></a><a class="rightMenu-item" href="javascript:window.location.reload();" rel="external nofollow noreferrer"><i class="fa fa-refresh"></i></a><a class="rightMenu-item" href="javascript:rmf.scrollToTop();" rel="external nofollow noreferrer"><i class="fa fa-arrow-up"></i></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-text"><a class="rightMenu-item" href="javascript:rmf.copySelect();" rel="external nofollow noreferrer"><i class="fa fa-copy"></i><span>复制</span></a><a class="rightMenu-item" href="javascript:window.open(&quot;https://www.baidu.com/s?wd=&quot;+window.getSelection().toString());window.location.reload();" rel="external nofollow noreferrer"><i class="iconfont icon-baidu"></i><span>百度搜索</span></a><a class="rightMenu-item" href="javascript:rmf.searchinThisPage();" rel="external nofollow noreferrer"><i class="fas fa-search"></i><span>站内搜索</span></a><a class="rightMenu-item" href="#post-comment" onclick="rmf.yinyong()"><i class="fa-solid fa-message"></i><span>引用文本评论</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-too"><a class="rightMenu-item" href="javascript:window.open(window.getSelection().toString());window.location.reload();" rel="external nofollow noreferrer"><i class="fa fa-link"></i><span>转到链接</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-paste"><a class="rightMenu-item" href="javascript:rmf.paste()" rel="external nofollow noreferrer"><i class="fa fa-copy"></i><span>粘贴</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-post"><a class="rightMenu-item" href="#post-comment"><i class="fas fa-comment"></i><span>空降评论</span></a><a class="rightMenu-item" href="javascript:switchCommentBarrage()" rel="external nofollow noreferrer"><i class="iconfont icon-danmu"></i><span>开/关评论弹幕</span></a><a class="rightMenu-item" href="javascript:rmf.copyWordsLink()" rel="external nofollow noreferrer"><i class="fa fa-link"></i><span>复制本文地址</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-to"><a class="rightMenu-item" href="javascript:rmf.openWithNewTab()" rel="external nofollow noreferrer"><i class="fa fa-window-restore"></i><span>新窗口打开</span></a><a class="rightMenu-item" id="menu-too" href="javascript:rmf.open()" rel="external nofollow noreferrer"><i class="fa fa-link"></i><span>转到链接</span></a><a class="rightMenu-item" href="javascript:rmf.copyLink()" rel="external nofollow noreferrer"><i class="fa fa-copy"></i><span>复制链接</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-img"><a class="rightMenu-item" href="javascript:rmf.saveAs()" rel="external nofollow noreferrer"><i class="fa fa-download"></i><span>保存图片</span></a><a class="rightMenu-item" href="javascript:rmf.openWithNewTab()" rel="external nofollow noreferrer"><i class="fa fa-window-restore"></i><span>在新窗口打开</span></a><a class="rightMenu-item" href="javascript:rmf.click()" rel="external nofollow noreferrer"><i class="fa fa-arrows-alt"></i><span>全屏显示</span></a><a class="rightMenu-item" href="javascript:rmf.copyLink()" rel="external nofollow noreferrer"><i class="fa fa-copy"></i><span>复制图片链接</span></a></div><div class="rightMenu-group rightMenu-line"><a class="rightMenu-item" href="javascript:toRandomPost()" rel="external nofollow noreferrer"><i class="fa fa-paper-plane"></i><span>随便逛逛</span></a><a class="rightMenu-item" href="javascript:rmf.switchDarkMode();" rel="external nofollow noreferrer"><i class="fa fa-moon"></i><span>昼夜切换</span></a><a class="rightMenu-item" href="javascript:rmf.translate();" rel="external nofollow noreferrer"><i class="iconfont icon-fanti"></i><span>繁简转换</span></a><a class="rightMenu-item" href="javascript:pjax.loadUrl(&quot;/license/&quot;);" rel="external nofollow noreferrer"><i class="fa fa-info-circle"></i><span>版权声明</span></a><a class="rightMenu-item" href="javascript:toggleWinbox();" rel="external nofollow noreferrer"><i class="fas fa-cog"></i><span>博客设置</span></a><a class="rightMenu-item" href="javascript:fullScreen();" rel="external nofollow noreferrer"><i class="fas fa-expand"></i><span>进入全屏</span></a></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo-api-ochre-mu.vercel.app/',
      region: '',
      onCommentLoaded: function () {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo-api-ochre-mu.vercel.app/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      countELement.textContent = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(runFn)
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script type="text/javascript" src="https://unpkg.zhimg.com/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/gh/nextapps-de/winbox/dist/winbox.bundle.min.js"></script><script async src="https://cdn.jsdelivr.net/npm/js-heo@1.0.11/categoryBar/categoryBar.js"></script><script async>let tianliGPT_postSelector = '\#post \#article-container';let tianliGPT_key = 'cb15e8574176e0a65dd7';</script><script src="https://cdn1.tianli0.top/gh/zhheo/Post-Abstract-AI@0.9/tianli_gpt.js"></script><script src="/js/fall_sakura.js" async></script><script src="/js/winbox.js" async></script><script src="/js/fps.js" async></script><div id="fps"></div><script defer src="/live2d-widget/autoload.js"></script><script src="https://cdn.bootcdn.net/ajax/libs/clipboard.js/2.0.11/clipboard.min.js"></script><script src="/js/share.js" async></script><script src="/js/tagsBarActive.js"></script><script src="/js/twikoo.js"></script><script src="/js/rightmenu.js"></script><script type="text/javascript" src="/js/commentBarrage.js"></script><script src="/js/lunar.js"></script><script src="/js/day.js"></script><script type="text/javascript" src="https://npm.elemecdn.com/sweetalert2@8.19.0/dist/sweetalert2.all.js"></script><script src="/zhheo/random.js"></script><script src="/js/icat.js"></script><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script>(() => {
  const isChatBtn = false
  const isChatHideShow = false

  if (isChatBtn) {
    const close = () => {
      Chatra('minimizeWidget')
      Chatra('hide')
    }

    const open = () => {
      Chatra('openChat', true)
      Chatra('show')
    }

    window.ChatraSetup = {
      startHidden: true
    }
  
    window.chatBtnFn = () => {
      const isShow = document.getElementById('chatra').classList.contains('chatra--expanded')
      isShow ? close() : open()
    }
  } else if (isChatHideShow) {
    window.chatBtn = {
      hide: () => {
        Chatra('hide')
      },
      show: () => {
        Chatra('show')
      }
    }
  }

  (function(d, w, c) {
    w.ChatraID = 't5kJToyhpEaL6dETK'
    var s = d.createElement('script')
    w[c] = w[c] || function() {
        (w[c].q = w[c].q || []).push(arguments)
    }
    s.async = true
    s.src = 'https://call.chatra.io/chatra.js'
    if (d.head) d.head.appendChild(s)
  })(document, window, 'Chatra')

})()</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div><!-- hexo injector body_end start --> <script data-pjax>if(document.getElementById('recent-posts') && (location.pathname ==='/'|| '/' ==='all')){
    var parent = document.getElementById('recent-posts');
    var child = '<div class="recent-post-item" style="width:100%;height: auto"><div id="catalog_magnet"><div class="magnet_item"><a class="magnet_link" href="https://binwenwu.github.io/categories/Linux/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1"><svg t="1691856688572" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="15020" width="16" height="16"><path d="M525.2 198.3c-8.6 5.6-15.2 13.8-18.9 23.4-3.8 12.4-3.2 25.6 1.5 37.7 3.9 12.7 11.7 23.8 22.2 31.8 5.4 3.8 11.6 6.2 18.2 7 6.6 0.8 13.2-0.3 19.1-3.3 7-3.9 12.6-10 15.9-17.3 3.2-7.4 5-15.3 5.2-23.3 0.7-10.2-0.6-20.4-3.8-30.1-3.5-10.6-10.3-19.7-19.5-25.9-4.7-3-9.9-5-15.4-5.8-5.5-0.8-11.1-0.2-16.3 1.8-2.9 1.2-5.7 2.7-8.3 4.5" fill="#FFFFFF" p-id="15021"></path><path d="M810.2 606.5c-5.1-28.3-13.1-56-23.8-82.6-7.3-19.8-17.2-38.6-29.5-55.8-12.4-16.5-28.1-30.4-40.2-47.1-6.4-8.7-11.8-18.4-18.5-26.9-2.7-5.6-5.3-11.2-7.9-16.8-8-17.5-15.3-35.4-24.8-52-1.5-2.6-3.1-5.2-4.6-7.7-1.2-16-2.9-32-3.8-48 0.7-32.1-2-64.3-8.1-95.9-4.2-15.1-10.6-29.6-19-42.8-9.8-15.6-22.4-29.2-37.2-40.1-24.1-17.1-52.9-26.3-82.4-26.4-21.7-0.5-43.2 4.4-62.5 14.4-20.3 11.1-36.7 28.2-47 48.9-9.6 20.9-14.7 43.5-15 66.5-0.8 22.6 1.3 45 2.2 67.6 0.9 23.4 0.4 46.9 2.3 70.3 0.6 7.5 1.5 15 1.5 22.6 0 3.8-0.2 7.6-0.3 11.3l-0.3 0.8c-10.2 17.3-21.5 34-33.8 49.9-8.6 10.9-17.2 21.7-25.9 32.4-11.3 12.7-20.9 26.8-28.5 42-5.1 13.2-9.2 26.8-12.4 40.6l-0.3 1.1c-4.8 15.9-10.8 31.3-18 46.2-0.7 1.4-1.4 2.9-2 4.2-4.3 8.9-8.8 17.8-13.5 26.5l-5.4 10.1c-3.4 6.1-6.4 12.4-9 18.8-1.5 3.9-2.7 7.9-3.4 12-1.3 8.7-0.7 17.5 1.6 25.9 0.5 2.1 1.2 4.2 1.9 6.3 2.2 6.2 4.8 12.3 7.9 18.1 1.4 2.7 2.9 5.3 4.3 8l1.3 1.9c1.4 2.5 2.9 5 4.4 7.4l0.2 0.3c1.7 2.8 3.6 5.5 5.4 8.2l0.3 0.4c1.9 2.6 3.8 5.3 5.8 7.9 7.4 28.9 21 55.8 39.7 79-2.9 5.1-5.5 10.1-8.4 15.1-10.2 14.8-18.6 30.7-25.1 47.4-2.7 8.6-3.4 17.7-1.9 26.6 1.4 9 6 17.1 13 23 4.7 3.6 10.1 6.1 15.8 7.3 5.7 1.2 11.6 1.8 17.5 1.5 22.2-1.7 44.2-6.1 65.4-12.9 12.8-3.4 25.6-6.4 38.6-9 13.5-3.1 27.2-5 41-5.6 3.4 0.1 6.8-0.1 10.1-0.3 9.4 1 18.8 1.4 28.3 1l3.5-0.2c2.4 0.3 4.9 0.4 7.4 0.6 16.6 0.9 33.1 2.6 49.5 5.1 14.4 2.2 28.8 5 43 8.5 21.9 6.6 44.4 11 67.3 12.9 6 0.3 12-0.2 18-1.4 5.9-1.2 11.5-3.8 16.3-7.4 7-5.8 11.6-13.9 13.1-22.9 1.5-8.9 0.8-18-1.9-26.6-6.6-16.7-15.1-32.6-25.5-47.3-3.6-6.1-7-12.4-10.6-18.5 15.5-17.3 29.2-36.3 40.7-56.5 7 0.4 13.9-0.4 20.6-2.6 17.5-5.9 32.7-17.3 43.3-32.5 3.2-4.5 5.7-9.5 7.2-14.8 6.9-10.7 11.6-22.7 13.8-35.3 3.2-20.8 2.7-42.1-1.5-62.7h-0.2z m0 0" fill="#020204" p-id="15022"></path><path d="M425.6 323.2c-3.1 4-5.3 8.7-6.4 13.6-1.1 4.9-1.8 10-1.9 15 0.3 10.1-0.5 20.2-2.5 30.1-3.5 10.3-8.8 19.8-15.6 28.3-11.7 14.7-20.9 31.2-27.2 48.8-3.2 10.9-4.3 22.3-3.1 33.7-12.1 17.9-22.6 36.9-31.3 56.7-13.4 29.9-22 61.8-25.5 94.4-4.3 40.1 1.6 80.6 17 117.8 11.3 26.8 28.5 50.8 50.3 70.1 11.2 9.7 23.5 17.9 36.7 24.4 46.7 22.8 101.4 22.3 147.6-1.4 23.1-13.5 44.2-30.2 62.6-49.5 11.9-10.8 22.5-22.9 31.8-36.1 15.5-26.9 24.6-57.1 26.5-88.1 9.6-53.6 3.7-108.8-16.9-159.2-8.1-16.8-18.8-32.2-31.8-45.6a252.5 252.5 0 0 0-20.2-68c-7.2-15.5-15.9-30.3-22.6-46.2-2.7-6.5-5.1-13.1-8.1-19.4-2.9-6.4-6.9-12.3-11.8-17.3-5.3-4.9-11.6-8.6-18.5-10.7-6.9-2.2-14-3.4-21.2-3.6-14.4-0.7-28.9 1.1-43.1 0.6-11.5-0.5-22.8-2.5-34.3-1.8-5.7 0.3-11.4 1.4-16.7 3.5-5.4 2.1-10.1 5.5-13.8 10m4.6-125.1c-5.4 0.4-10.5 2.7-14.4 6.4-3.9 3.7-6.8 8.4-8.4 13.5-2.7 10.4-3.4 21.3-1.9 32 0.2 9.7 1.9 19.4 5.1 28.6 1.8 4.5 4.4 8.7 7.8 12.2 3.4 3.5 7.7 6.1 12.4 7.3 4.5 1.1 9.2 0.9 13.5-0.5 4.3-1.4 8.3-3.8 11.5-7 4.7-4.8 8.1-10.7 9.8-17.1 1.7-6.4 2.5-13.1 2.3-19.8 0-8.3-1.3-16.6-3.8-24.6s-6.8-15.3-12.6-21.4c-2.8-2.9-6-5.4-9.6-7.2-3.7-1.7-7.7-2.6-11.7-2.4m95 0c-8.6 5.6-15.2 13.8-18.9 23.4-3.8 12.4-3.2 25.6 1.5 37.7 3.9 12.7 11.7 23.8 22.2 31.8 5.4 3.8 11.6 6.2 18.2 7 6.6 0.8 13.2-0.3 19.1-3.3 7-3.9 12.6-10 15.9-17.3 3.2-7.4 5-15.3 5.2-23.3 0.7-10.2-0.6-20.4-3.8-30.1-3.5-10.6-10.3-19.7-19.5-25.9-4.7-3-9.9-5-15.4-5.8-5.5-0.8-11.1-0.2-16.3 1.8-2.9 1.2-5.7 2.7-8.3 4.5" fill="#FFFFFF" p-id="15023"></path><path d="M544.5 223.6c-3.2 0.2-6.2 1.2-8.9 2.9s-5 4-6.8 6.6c-3.4 5.3-5.3 11.5-5.4 17.9-0.3 4.7 0.4 9.5 1.9 14s4.3 8.5 7.9 11.5c3.8 3.1 8.4 4.9 13.3 5.2 4.9 0.2 9.7-1.1 13.7-3.9 3.2-2.3 5.8-5.2 7.6-8.7 1.8-3.4 2.9-7.2 3.4-11 1-6.8-0.2-13.8-3.2-19.9-3.1-6.2-8.4-10.9-14.8-13.4-2.8-1.1-5.7-1.5-8.7-1.4" fill="#020204" p-id="15024"></path><path d="M430.2 198.3c-5.4 0.4-10.5 2.7-14.4 6.4-3.9 3.7-6.8 8.4-8.4 13.5-2.7 10.4-3.4 21.3-1.9 32 0.2 9.7 1.9 19.4 5.1 28.6 1.8 4.6 4.4 8.7 7.8 12.2 3.4 3.5 7.7 6.1 12.4 7.3 4.5 1.1 9.2 0.9 13.5-0.5 4.3-1.4 8.3-3.8 11.5-7 4.7-4.8 8.1-10.7 9.8-17.1 1.7-6.4 2.5-13.1 2.3-19.8 0-8.3-1.3-16.6-3.8-24.6s-6.8-15.3-12.6-21.4c-2.8-2.9-6-5.4-9.6-7.2-3.7-1.7-7.7-2.6-11.7-2.4" fill="#FFFFFF" p-id="15025"></path><path d="M417.3 242.8c-1.3 6.7-1 13.7 1.1 20.2 1.6 4.3 4 8.2 7.2 11.5 2 2.2 4.3 4.1 7 5.4 2.7 1.4 5.7 1.8 8.7 1.1 2.7-0.7 5-2.3 6.7-4.5 1.7-2.2 2.9-4.7 3.7-7.3 2.3-7.8 2.1-16.1-0.4-23.9-1.6-5.7-4.7-10.9-9.1-14.8-2.1-1.8-4.7-3.2-7.4-3.9-2.8-0.7-5.7-0.5-8.4 0.7-2.8 1.4-5.1 3.7-6.5 6.5-1.4 2.8-2.3 5.8-2.7 8.9" fill="#020204" p-id="15026"></path><path d="M404.6 326.9c0.2 0.9 0.5 1.8 1 2.5 0.9 1.4 2 2.5 3.4 3.4 1.3 0.9 2.6 1.7 3.9 2.5 6.9 4.7 13 10.5 17.9 17.3 6 9.4 13.5 17.8 22 25 6.5 4.5 14.1 7.2 22 7.9 9.2 0.7 18.5-0.4 27.4-3.2 8.2-2.4 16.1-5.8 23.5-10.3 12.7-10.2 26.3-19.2 40.7-26.7 3.4-1.2 6.8-2.1 10-3.6 3.3-1.4 6.1-3.8 7.8-7 1.1-3.2 1.8-6.6 1.9-10 0.5-3.6 1.7-7.1 2.3-10.7 0.8-3.6 0.5-7.3-0.8-10.8-1.4-2.7-3.6-4.9-6.3-6.3-2.7-1.3-5.7-2.1-8.7-2.2-6.1 0.2-12.1 0.8-18 1.8-8 0.7-16-0.3-24 0-9.9 0.3-19.8 2.5-29.8 2.9-11.4 0.6-22.7-1.2-34.1-1.7-4.9-0.3-9.9-0.1-14.8 0.7-4.9 0.7-9.6 2.5-13.7 5.3-3.8 3-7.3 6.2-10.7 9.6-1.8 1.6-3.8 3-5.9 4.1-2.2 1.1-4.5 1.7-7 1.6-1.2-0.2-2.5-0.2-3.7 0-0.7 0.3-1.4 0.7-1.9 1.2l-1.5 1.8c-1 1.5-1.9 3.1-2.6 4.7" fill="#D99A03" p-id="15027"></path><path d="M429.7 301.7c-4 2.4-7.9 5-11.8 7.7-2.1 1.3-3.8 3-5.1 5.1-0.7 1.6-1 3.3-0.9 5 0.1 1.7 0.1 3.4 0 5.1-0.1 1.1-0.5 2.3-0.5 3.5 0 0.6 0 1.2 0.2 1.7 0.2 0.6 0.4 1.1 0.8 1.5 0.5 0.5 1.2 0.9 2 1.1 0.7 0.2 1.5 0.3 2.3 0.5 3.5 1 6.7 2.9 9.3 5.4 2.7 2.4 5.1 5.2 8 7.5 8 6 17.7 9.1 27.6 9 9.9-0.2 19.7-1.6 29.2-4.1 7.5-1.6 14.9-3.6 22.1-6.1 11.2-4.2 21.5-10.3 30.4-18.2 3.9-3.8 8-7.2 12.4-10.3 4-2.5 8.7-4.2 12.7-6.6 0.4-0.2 0.7-0.5 1.1-0.7 0.3-0.3 0.6-0.6 0.8-1 0.3-0.7 0.3-1.5 0-2.2-0.2-0.7-0.5-1.3-0.9-1.8-0.5-0.6-1.1-1.2-1.7-1.7-4.6-3.4-10.1-5.3-15.8-5.5-5.8-0.4-11.3 0-16.9-1.1-5.2-1.1-10.3-2.6-15.3-4.4-5.3-1.7-10.7-3-16.3-3.9-13-2.1-26.2-1.8-39.1 1-12.1 2.7-23.8 7.3-34.6 13.5" fill="#604405" p-id="15028"></path><path d="M428.4 288.1c-5.8 3.9-11 8.7-15.5 14.1-2.6 3-4.7 6.5-6.1 10.3-0.9 3-1.5 6.1-2 9.2-0.3 1.1-0.5 2.3-0.5 3.5 0 0.6 0.1 1.2 0.3 1.7 0.2 0.6 0.5 1.1 0.9 1.5 0.7 0.7 1.6 1.1 2.6 1.3 0.9 0.2 1.9 0.2 2.9 0.3 4.4 0.7 8.5 2.5 12.1 5.1 3.6 2.5 7 5.4 10.7 7.8 8.4 5 18 7.7 27.8 7.9 9.8 0.2 19.5-0.8 29-2.9 7.6-1.4 15.1-3.5 22.4-6.3 10.9-4.7 21.1-10.8 30.4-18.2 4.3-3.2 8.5-6.6 12.4-10.3 1.3-1.3 2.6-2.6 4-3.8 1.4-1.2 3-2.1 4.7-2.7 2.7-0.7 5.5-0.8 8.3-0.1 2 0.5 4.1 0.7 6.2 0.7 1.1 0 2.1-0.2 3.1-0.5 1-0.4 1.9-1 2.5-1.8 0.9-1.1 1.3-2.4 1.3-3.8s-0.4-2.7-1.1-3.9c-1.5-2.3-3.8-4.1-6.3-5.1-3.5-1.4-7.1-2.5-10.8-3.2-11.3-2.7-22.3-6.7-32.7-11.9-5.2-2.6-10.1-5.4-15.3-8.1-5.2-2.9-10.6-5.4-16.2-7.2-12.9-3.5-26.6-2.9-39.1 1.8-14 4.9-26.5 13.4-36.1 24.7" fill="#F5BD0C" p-id="15029"></path><path d="M493.5 272.2c0.7 2.3 4.3 1.9 6.4 2.9 2.1 1 3.3 2.9 5.3 3.1 2.1 0.2 5-0.7 5.3-2.6 0.4-2.6-3.4-4.2-5.8-5.1-3.2-1.5-6.8-1.6-10-0.2-0.7 0.3-1.4 1.2-1.2 1.9z m-34.4-1.2c-2.7-0.9-7.1 3.8-5.8 6.3 0.4 0.7 1.6 1.5 2.4 1.1 0.8-0.4 2.3-3.1 3.6-4 1-0.8 0.8-3.1-0.2-3.4z m0 0" fill="#CD8907" p-id="15030"></path><path d="M887.7 829.8c-2 5.2-4.9 10-8.5 14.3-8.4 9-18.6 16.2-29.8 21.2-19 8.8-37.5 18.6-55.5 29.3-11.7 7.8-22.6 16.6-32.7 26.4-8.3 8.7-17.2 16.7-26.6 24.2-9.8 7.2-21.1 12.1-33.1 14-14.7 1.9-29.6-0.4-43.1-6.5-9.7-3.7-18.1-10.2-24-18.8-5-9.2-7.3-19.5-6.8-29.9 0.6-18.3 2.8-36.5 6.6-54.5 2.6-15 5.2-30 6.8-45.1 2.8-27.6 3.1-55.3 1-82.9-0.5-4.6-0.5-9.3 0-13.9 0.6-9.4 8.5-16.6 18-16.5 4.3-0.1 8.6 0.3 12.8 1.1 10 1.2 20 2.9 29.8 5.2 6.1 1.6 12.2 3.8 18.3 5.5 10.2 3 21 3.9 31.6 2.9 11.1-2.6 22.4-4.3 33.8-5.3 4.7 0.2 9.4 1 13.8 2.4 4.6 1.3 8.9 3.6 12.4 6.9 2.5 2.7 4.5 5.8 5.8 9.2 1.9 5.1 3.1 10.4 3.5 15.8 0.2 4.8 0.6 9.6 1.2 14.4 1.7 7.7 5.4 14.9 10.6 20.9 5.3 5.8 11 11.2 17.2 16 5.9 5.2 12.1 10 18.6 14.4 3.1 2.1 6.2 4 9.1 6.3 3 2.2 5.5 5 7.4 8.2 2.4 4.4 3.2 9.5 2 14.4" fill="#F5BD0C" p-id="15031"></path><path d="M887.7 829.8c-2 5.2-4.9 10-8.5 14.3-8.4 9-18.6 16.2-29.8 21.2-19 8.8-37.5 18.6-55.5 29.3-11.7 7.8-22.6 16.6-32.7 26.4-8.3 8.7-17.2 16.7-26.6 24.2-9.8 7.2-21.1 12.1-33.1 14-14.7 1.9-29.6-0.4-43.1-6.5-9.7-3.7-18.1-10.2-24-18.8-5-9.2-7.3-19.5-6.8-29.9 0.6-18.3 2.8-36.5 6.6-54.5 2.6-15 5.2-30 6.8-45.1 2.8-27.6 3.1-55.3 1-82.9-0.5-4.6-0.5-9.3 0-13.9 0.6-9.4 8.5-16.6 18-16.5 4.3-0.1 8.6 0.3 12.8 1.1 10 1.2 20 2.9 29.8 5.2 6.1 1.6 12.2 3.8 18.3 5.5 10.2 3 21 3.9 31.6 2.9 11.1-2.6 22.4-4.3 33.8-5.3 4.7 0.2 9.4 1 13.8 2.4 4.6 1.3 8.9 3.6 12.4 6.9 2.5 2.7 4.5 5.8 5.8 9.2 1.9 5.1 3.1 10.4 3.5 15.8 0.2 4.8 0.6 9.6 1.2 14.4 1.7 7.7 5.4 14.9 10.6 20.9 5.3 5.8 11 11.2 17.2 16 5.9 5.2 12.1 10 18.6 14.4 3.1 2.1 6.2 4 9.1 6.3 3 2.2 5.5 5 7.4 8.2 2.4 4.4 3.2 9.5 2 14.4M259.4 676.3c4.9-1.9 10.2-2.4 15.4-1.4 5.2 1 10.1 3.1 14.4 6.1 8.3 6.3 15.5 14.1 21.2 22.8 14.1 19.4 27.6 39.2 39.9 59.8 10 16.7 19.1 33.9 30.6 49.6 7.5 10.2 16 19.7 23.6 29.9 7.9 10 13.9 21.4 17.6 33.5 4.4 16.1 2.6 33.2-4.9 48.1-5.4 10.4-13.5 19.1-23.4 25.1-10 6-21.5 9-33.2 8.7-18.4-2.5-36.2-8.1-52.6-16.6-34.9-13.9-72.8-18.3-108.8-29.1-11.1-3.3-21.9-7.3-33.1-10.3-5-1.2-9.9-2.7-14.7-4.7-4.7-2-8.8-5.4-11.5-9.7-2-3.5-3-7.5-2.9-11.5 0.1-4 0.9-7.9 2.3-11.5 2.7-7.5 7.1-14.2 10-21.6 4.4-12.2 6.1-25.3 5-38.2-0.6-12.9-2.9-25.8-3.6-38.7-0.6-5.8-0.4-11.6 0.6-17.3 1.5-11.4 10.4-20.5 21.9-22.2 5.3-0.9 10.6-1.3 15.9-1 5.3 0.3 10.7 0.3 16 0 5.3-0.3 10.6-1.8 15.3-4.3 4.3-2.6 8.1-6.2 11-10.4 2.9-4.2 5.5-8.5 7.9-13 2.4-4.5 5.1-8.7 8.3-12.7 3-4.1 7.1-7.2 11.8-9.4" fill="#F5BD0C" p-id="15032"></path><path d="M259.4 676.4c4.9-1.9 10.2-2.4 15.4-1.4 5.2 1 10.1 3.1 14.4 6.1 8.3 6.3 15.5 14.1 21.2 22.8 14.1 19.4 27.6 39.2 39.9 59.8 10 16.7 19.1 33.9 30.6 49.6 7.5 10.2 16 19.7 23.6 29.9 7.9 10 13.9 21.4 17.6 33.5 4.4 16.1 2.6 33.2-4.9 48.1-5.4 10.4-13.5 19.1-23.4 25.1-10 6-21.5 9-33.2 8.7-18.4-2.5-36.2-8.1-52.6-16.6-34.9-13.9-72.8-18.3-108.8-29.1-11.1-3.3-21.9-7.3-33.1-10.3-5-1.2-9.9-2.7-14.7-4.7-4.7-2-8.8-5.4-11.5-9.7-2-3.5-3-7.5-2.9-11.5 0.1-4 0.9-7.9 2.3-11.5 2.7-7.5 7.1-14.2 10-21.6 4.4-12.2 6.1-25.3 5-38.2-0.6-12.9-2.9-25.7-3.6-38.7-0.6-5.8-0.4-11.6 0.6-17.3 1.5-11.4 10.4-20.5 21.9-22.2 5.3-0.9 10.6-1.3 15.9-1 5.3 0.3 10.7 0.3 16 0 5.3-0.3 10.6-1.8 15.3-4.3 4.3-2.6 8.1-6.2 11-10.4 2.9-4.2 5.5-8.5 7.9-13 2.4-4.5 5.1-8.7 8.3-12.7 3-4.1 7.1-7.3 11.8-9.4" fill="#F5BD0C" p-id="15033"></path><path d="M267.1 684.8c4.4-1.7 9.3-2 13.9-0.9s8.9 3.2 12.6 6.2c7.1 6.2 13.1 13.6 17.6 21.9 12 19.4 23.7 39 34.6 59 7.9 15.3 16.8 30.1 26.6 44.2 6.8 9.2 14.6 17.6 21.6 26.6 7.3 8.9 12.8 19 16.2 29.9 4 14.3 2.3 29.6-4.5 42.9-5 9.4-12.5 17.3-21.7 22.6-9.2 5.4-19.8 8-30.4 7.5-16.7-2.6-32.9-7.6-48.2-14.9-30.4-11.1-63.5-12.5-94.7-21.2-11.2-3-22.1-7.1-33.4-9.9-5-1.1-10-2.5-14.8-4.3-4.8-1.8-9-5.2-11.8-9.5-1.8-3.4-2.7-7.2-2.5-11 0.2-3.8 1-7.6 2.4-11.2 2.7-7.1 7-13.6 9.7-20.7 3.8-11 5.1-22.6 3.9-34.2-0.8-11.5-2.9-22.9-3.5-34.5-0.4-5.1-0.2-10.3 0.7-15.4 0.9-5.1 3.3-9.8 6.9-13.6 4.2-3.8 9.4-6.3 15-7 5.6-0.7 11.2-0.7 16.7 0 5.6 0.7 11.2 0.9 16.8 0.8 11 0 21-6.4 25.7-16.4 2.3-4.5 4.3-9.2 5.9-13.9 1.7-4.8 4-9.3 6.7-13.6 2.8-4.3 6.8-7.7 11.5-9.7" fill="#F5BD0C" p-id="15034"></path></svg> 小吴のLinux (6)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://binwenwu.github.io/categories/云原生/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1"><svg t="1691856792091" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16426" width="16" height="16"><path d="M506.325333 85.333333a115.904 115.904 0 0 1 115.648 125.397334 114.133333 114.133333 0 0 1-6.464 28.778666l0.192-0.426666 215.68 124.586666v250.666667c-3.029333-0.597333-6.101333-0.789333-9.173333-1.152a114.88 114.88 0 0 1 52.245333 19.541333 115.925333 115.925333 0 0 1-131.925333 190.592 114.154667 114.154667 0 0 1-23.36-21.845333l1.706667 2.304-215.466667 124.586667-217.536-125.632a114.773333 114.773333 0 0 1-37.034667 28.245333 115.946667 115.946667 0 0 1-154.346666-55.210667 115.904 115.904 0 0 1 55.232-154.346666c9.024-4.266667 18.325333-6.912 27.669333-8.682667h-0.021333V363.605333l217.514666-125.589333-1.706666-5.482667a113.28 113.28 0 0 1-4.266667-40.746666A115.925333 115.925333 0 0 1 506.346667 85.333333z m-72.874666 205.461334v0.021333l-190.08 109.738667v218.346666l6.037333 2.602667a115.605333 115.605333 0 0 1 32.725333 22.293333l66.346667-37.696 31.573333 55.658667-66.048 37.546667c3.626667 15.146667 3.754667 30.506667 1.322667 45.376l190.08 109.653333 189.013333-109.226667 0.170667 0.853334a116.970667 116.970667 0 0 1 2.112-46.762667l-65.834667-38.613333 32.405334-55.189334 65.536 38.442667a115.264 115.264 0 0 1 46.933333-26.688c-2.794667 0.810667-5.632 1.472-8.362667 2.517333v-219.093333l-189.013333-109.226667v-0.021333a116.544 116.544 0 0 1-40.981333 21.141333l-0.512 76.309334-64-0.448 0.512-75.989334a114.624 114.624 0 0 1-39.936-21.546666z m404.586666 394.538666a51.989333 51.989333 0 0 0-74.581333 16.853334 52.138667 52.138667 0 0 0 15.488 68.522666 51.989333 51.989333 0 0 0 74.56-16.832 52.16 52.16 0 0 0-15.466667-68.544z m-591.872 14.805334a52.117333 52.117333 0 0 0-67.072-20.864 51.989333 51.989333 0 0 0-22.72 72.981333 52.138667 52.138667 0 0 0 67.093334 20.864 51.925333 51.925333 0 0 0 22.698666-72.981333zM505.386667 416.341333l117.333333 67.733334v135.488l-117.333333 67.733333-117.333334-67.733333v-135.466667l117.333334-67.754667z m0 73.898667l-53.333334 30.784v61.589333l53.333334 30.784 53.333333-30.784v-61.589333l-53.333333-30.784zM506.346667 149.333333a52.16 52.16 0 0 0-51.626667 47.68 51.989333 51.989333 0 0 0 51.84 56.149334 52.117333 52.117333 0 0 0 51.626667-47.658667A51.946667 51.946667 0 0 0 506.346667 149.333333z" fill="#2B85FB" p-id="16427"></path></svg> 小吴の云原生 (4)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://binwenwu.github.io/categories/GIS/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1"><svg t="1691856809832" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="17575" width="16" height="16"><path d="M1023.98404 512c0 282.749582-229.216418 512-511.984 512C229.234458 1024 0.00004 794.749582 0.00004 512 0.00004 229.234418 229.234458 0 512.00004 0 794.767622 0 1023.98404 229.234418 1023.98404 512z" fill="#5D9CEC" p-id="17576"></path><path d="M998.890432 353.204481c-24.031625-73.688849-65.404978-142.171779-119.718129-198.046905-54.249152-55.781128-121.438103-99.078452-194.280964-125.218044l-21.281668-7.63988-6.3759 21.71766c-2.937954 9.907845-5.155919 17.063733-6.689896 21.375666-18.999703 8.905861-39.311386 16.937735-58.967078 24.749614-62.71502 24.841612-127.544007 50.54521-172.263309 109.482289-19.455696 25.6256-21.705661 52.391181-5.859908 69.828909 8.29587 9.139857 20.375682 13.781785 35.905439 13.781784 10.123842 0 20.687677-1.90597 29.999531-3.577944 6.561897-1.187981 13.343792-2.405962 17.327729-2.405962 0.295995 0 0.561991 0.016 0.827987 0.031999 22.921642 1.639974 65.624975 9.749848 103.874377 19.717692 42.031343 10.937829 64.312995 20.187685 73.812847 25.579601-6.3759 7.593881-23.467633 19.329698-46.345276 19.329698-11.187825 0-22.061655-2.889955-32.375494-8.579866-15.781753-8.703864-55.281136-16.967735-109.718286-26.687583l-5.281917-0.953985c-2.281964-0.405994-4.889924-0.60999-7.953876-0.609991-22.875643 0-76.8288 11.077827-117.218168 53.031172-35.327448 36.671427-52.045187 87.218637-49.687224 150.217652 1.453977 38.733395 14.593772 71.608881 38.015406 95.044515 23.765629 23.813628 56.875111 36.595428 95.734504 37.063421 4.623928 0.032 9.265855 0.032 13.875783 0.032h3.093952c22.453649 0 45.655287 0 62.811019 6.467899 10.985828 4.123936 24.517617 12.249809 31.829502 38.625396 7.561882 27.437571 9.749848 55.499133 11.999813 85.216669 2.123967 27.967563 4.375932 56.905111 11.49982 85.654661 14.123779 56.93911 43.217325 71.156888 65.122983 73.064859 3.123951 0.249996 6.249902 0.375994 9.311854 0.375994 48.751238 0 81.124732-32.813487 107.594319-63.595007 6.311901-7.345885 13.217793-14.439774 20.531679-21.939657 16.125748-16.531742 32.813487-33.623475 44.689302-55.343135 13.717786-24.999609 18.623709-51.249199 23.437634-76.592803 4.49993-24.061624 8.811862-46.783269 20.249683-66.656959 1.561976-2.687958 3.375947-5.74991 5.375916-9.217856 58.095092-99.610444 72.062874-136.483867 59.783066-157.873533-5.531914-9.59385-15.655755-14.781769-27.469571-13.875783-5.623912 0.437993-11.187825 0.65599-16.499742 0.65599-34.999453 0-63.937001-9.62585-79.404759-26.407588-4.375932-4.749926-6.467899-8.843862-7.405884-11.563819 0.531992-0.032 1.123982-0.045999 1.811971-0.045999 10.24984 0 25.999594 4.203934 41.217356 8.28187 18.405712 4.937923 37.467415 10.031843 54.217153 10.031843 27.283574 0 45.033296-14.171779 48.939235-38.98539 3.875939-7.03189 22.061655-24.171622 34.375463-25.781598l25.499602-3.327948-7.967876-24.431618zM164.297473 611.750441c-16.033749-23.313636-34.391463-45.875283-50.875205-68.828924-15.35976-21.405666-75.310823-118.750145-103.094389-133.717911A514.623959 514.623959 0 0 0 0.00004 512c0 124.624053 44.533304 238.812269 118.532148 327.622881 0.061999 0.061999 0.171997 0.093999 0.327995 0.093998 4.48393 0 46.189278-30.999516 49.969219-34.217465 16.421743-13.937782 30.171529-30.967516 36.327432-51.937188 14.359776-48.811237-13.859783-102.562397-40.859361-141.811785z" fill="#A0D468" p-id="17577"></path></svg> 小吴のGIS (1)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://binwenwu.github.io/categories/前端开发/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1"><svg t="1691856852779" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="20406" width="16" height="16"><path d="M204.8 860.842667h568.832" fill="#FFFFFF" p-id="20407"></path><path d="M136.533333 217.429333h705.365334a34.133333 34.133333 0 0 1 34.133333 34.133334v432.469333A22.698667 22.698667 0 0 1 853.333333 706.730667H125.098667A22.698667 22.698667 0 0 1 102.4 684.032V251.562667a34.133333 34.133333 0 0 1 34.133333-34.133334z" fill="#FCFEFF" p-id="20408"></path><path d="M876.032 251.562667v432.298666A22.698667 22.698667 0 0 1 853.333333 706.730667H474.453333l178.176-489.301334h189.269334a34.133333 34.133333 0 0 1 34.133333 34.133334z" fill="#EDF4FF" p-id="20409"></path><path d="M716.8 860.842667H261.632a57.002667 57.002667 0 0 1 57.002667-56.832h341.333333A56.832 56.832 0 0 1 716.8 860.842667z" fill="#FFFFFF" p-id="20410"></path><path d="M598.528 706.730667h-218.453333l-27.306667 97.28h273.066667l-27.306667-97.28z" fill="#C3CFDE" p-id="20411"></path><path d="M876.032 251.562667v68.266666H102.4v-68.266666a34.133333 34.133333 0 0 1 34.133333-34.133334h705.365334a34.133333 34.133333 0 0 1 34.133333 34.133334z" fill="#96DDFF" p-id="20412"></path><path d="M841.898667 217.429333H652.629333l-37.205333 102.4h260.608v-68.266666a34.133333 34.133333 0 0 0-34.133333-34.133334z" fill="#69BAF9" p-id="20413"></path><path d="M716.8 860.842667H261.632a57.002667 57.002667 0 0 1 57.002667-56.832h341.333333A56.832 56.832 0 0 1 716.8 860.842667z" fill="#EDF4FF" p-id="20414"></path><path d="M782.165333 903.168a158.549333 158.549333 0 0 0 25.6-2.048 21.845333 21.845333 0 0 1 22.698667 10.581333 22.016 22.016 0 0 0 30.208 8.021334l36.010667-20.821334a22.186667 22.186667 0 0 0 7.850666-30.037333 22.186667 22.186667 0 0 1 2.048-25.088 160.256 160.256 0 0 0 25.6-44.544 22.016 22.016 0 0 1 21.162667-14.165333 22.186667 22.186667 0 0 0 22.186667-22.186667v-41.642667a22.186667 22.186667 0 0 0-22.186667-22.186666 22.016 22.016 0 0 1-20.650667-14.336 162.645333 162.645333 0 0 0-25.6-44.544 21.845333 21.845333 0 0 1-2.56-24.917334 22.357333 22.357333 0 0 0-8.192-30.378666l-36.010666-20.821334a22.016 22.016 0 0 0-30.208 8.192 22.016 22.016 0 0 1-22.698667 10.752 148.821333 148.821333 0 0 0-51.2 0 22.016 22.016 0 0 1-22.357333-10.752 22.186667 22.186667 0 0 0-30.208-8.192l-36.010667 20.821334a22.357333 22.357333 0 0 0-8.192 30.378666 21.845333 21.845333 0 0 1-2.048 24.917334A162.645333 162.645333 0 0 0 631.466667 684.714667a22.016 22.016 0 0 1-20.48 15.018666 22.186667 22.186667 0 0 0-22.186667 22.186667v40.96a22.186667 22.186667 0 0 0 22.186667 22.186667 22.016 22.016 0 0 1 20.650666 14.165333 160.256 160.256 0 0 0 25.6 44.544 22.186667 22.186667 0 0 1 2.048 25.088 22.186667 22.186667 0 0 0 8.192 30.208l36.010667 20.821333a22.016 22.016 0 0 0 30.378667-8.021333 21.845333 21.845333 0 0 1 22.698666-10.581333 158.549333 158.549333 0 0 0 25.6 1.877333z" fill="#79DEB4" p-id="20415"></path><path d="M975.530667 721.066667v41.642666a22.186667 22.186667 0 0 1-22.186667 22.186667 22.186667 22.186667 0 0 0-20.650667 14.336 162.645333 162.645333 0 0 1-25.6 44.544 22.528 22.528 0 0 0-4.949333 13.994667 20.992 20.992 0 0 0 2.901333 10.922666 22.357333 22.357333 0 0 1-8.192 30.378667l-36.010666 20.821333a22.016 22.016 0 0 1-30.208-8.192 22.016 22.016 0 0 0-22.698667-10.752 148.821333 148.821333 0 0 1-51.2 0 22.016 22.016 0 0 0-22.698667 10.752 22.186667 22.186667 0 0 1-30.208 8.192l-36.010666-20.821333a22.357333 22.357333 0 0 1-8.192-30.378667 20.821333 20.821333 0 0 0 2.389333-6.144l240.64-241.152a21.674667 21.674667 0 0 0 4.437333 18.773334 162.645333 162.645333 0 0 1 25.6 44.544 22.186667 22.186667 0 0 0 20.650667 14.336 22.186667 22.186667 0 0 1 22.186667 22.016z" fill="#62CCA1" p-id="20416"></path><path d="M782.165333 742.058667m-60.416 0a60.416 60.416 0 1 0 120.832 0 60.416 60.416 0 1 0-120.832 0Z" fill="#FCFEFF" p-id="20417"></path><path d="M159.232 268.629333m-17.066667 0a17.066667 17.066667 0 1 0 34.133334 0 17.066667 17.066667 0 1 0-34.133334 0Z" fill="#3D3D63" p-id="20418"></path><path d="M273.066667 268.629333m-17.066667 0a17.066667 17.066667 0 1 0 34.133333 0 17.066667 17.066667 0 1 0-34.133333 0Z" fill="#3D3D63" p-id="20419"></path><path d="M216.234667 268.629333m-17.066667 0a17.066667 17.066667 0 1 0 34.133333 0 17.066667 17.066667 0 1 0-34.133333 0Z" fill="#3D3D63" p-id="20420"></path><path d="M341.333333 516.266667l51.2-51.2a17.066667 17.066667 0 1 0-24.234666-24.234667l-63.488 63.658667a17.066667 17.066667 0 0 0 0 24.064l63.488 63.658666a17.066667 17.066667 0 0 0 24.234666 0 17.066667 17.066667 0 0 0 0-24.064zM585.728 591.872a17.066667 17.066667 0 0 0 24.064 0L673.450667 529.066667a17.066667 17.066667 0 0 0 0-24.064l-63.658667-63.658667a17.066667 17.066667 0 0 0-24.064 24.234667l51.2 51.2-51.2 51.2a17.066667 17.066667 0 0 0 0 23.893333zM529.066667 446.293333a17.066667 17.066667 0 0 0-23.381334 6.314667L442.709333 563.2a17.066667 17.066667 0 1 0 29.525334 17.066667l63.658666-110.08a17.066667 17.066667 0 0 0-6.826666-23.893334z" fill="#3D3D63" p-id="20421"></path><path d="M953.344 682.666667a4.949333 4.949333 0 0 1-4.608-3.242667 178.005333 178.005333 0 0 0-28.501333-49.322667 4.949333 4.949333 0 0 1 0-5.632 39.253333 39.253333 0 0 0-14.336-53.589333l-12.8-7.68V251.562667a51.2 51.2 0 0 0-51.2-51.2H136.533333a51.2 51.2 0 0 0-51.2 51.2v432.469333a39.936 39.936 0 0 0 39.765334 39.765333H358.4l-17.066667 63.146667h-22.698666a73.898667 73.898667 0 0 0-71.850667 56.832H204.8a17.066667 17.066667 0 0 0 0 34.133333h434.688a36.181333 36.181333 0 0 0 1.194667 12.117334 38.4 38.4 0 0 0 18.261333 23.893333l36.010667 20.821333a39.253333 39.253333 0 0 0 53.589333-14.506666 5.290667 5.290667 0 0 1 5.290667-2.389334 166.229333 166.229333 0 0 0 56.661333 0 5.12 5.12 0 0 1 5.290667 2.56 39.253333 39.253333 0 0 0 34.133333 19.456 38.741333 38.741333 0 0 0 19.626667-5.12l36.010666-20.821333a39.082667 39.082667 0 0 0 18.261334-23.893333 38.570667 38.570667 0 0 0-3.925334-29.696 5.12 5.12 0 0 1 0-5.802667 179.541333 179.541333 0 0 0 28.501334-49.152 4.778667 4.778667 0 0 1 4.608-3.242667 39.424 39.424 0 0 0 39.253333-39.253333v-41.642667A39.253333 39.253333 0 0 0 953.344 682.666667zM119.466667 251.562667a17.066667 17.066667 0 0 1 17.066666-17.066667h705.365334a17.066667 17.066667 0 0 1 17.066666 17.066667v51.2H119.466667z m5.632 438.101333a5.632 5.632 0 0 1-5.632-5.632V336.896h739.498666V546.133333a39.082667 39.082667 0 0 0-43.178666 17.066667 4.949333 4.949333 0 0 1-5.12 2.218667 175.274667 175.274667 0 0 0-56.661334 0 4.778667 4.778667 0 0 1-5.12-2.218667 39.082667 39.082667 0 0 0-53.589333-14.336l-36.010667 20.821333a38.229333 38.229333 0 0 0-18.261333 23.722667 39.594667 39.594667 0 0 0 3.754667 29.866667 4.608 4.608 0 0 1 0 5.632 178.005333 178.005333 0 0 0-28.501334 49.322666 4.949333 4.949333 0 0 1-4.608 3.242667 39.082667 39.082667 0 0 0-23.210666 7.68zM580.266667 786.944H375.466667l17.066666-63.146667h179.2v39.082667a39.594667 39.594667 0 0 0 8.533334 24.064z m-261.461334 34.133333h303.786667a187.733333 187.733333 0 0 0 13.312 22.698667H282.794667a39.765333 39.765333 0 0 1 35.84-22.698667z m639.658667-58.197333a5.12 5.12 0 0 1-5.12 5.12 39.424 39.424 0 0 0-36.693333 25.258667 144.384 144.384 0 0 1-22.869334 39.765333 39.424 39.424 0 0 0-3.584 44.373333 4.437333 4.437333 0 0 1 0 3.754667 4.949333 4.949333 0 0 1-2.389333 3.242667L852.309333 904.533333a5.12 5.12 0 0 1-6.997333-2.048 39.424 39.424 0 0 0-40.448-18.944 135.168 135.168 0 0 1-45.397333 0 39.424 39.424 0 0 0-40.448 19.114667 5.290667 5.290667 0 0 1-6.997334 1.877333l-36.010666-20.821333a4.949333 4.949333 0 0 1-2.389334-3.242667 4.437333 4.437333 0 0 1 0-3.754666 39.765333 39.765333 0 0 0-3.584-44.373334 142.506667 142.506667 0 0 1-23.04-39.765333A38.912 38.912 0 0 0 610.986667 768a5.12 5.12 0 0 1-5.12-5.12v-41.642667a4.949333 4.949333 0 0 1 5.12-5.12 39.253333 39.253333 0 0 0 36.522666-25.258666 140.117333 140.117333 0 0 1 23.04-39.765334 39.765333 39.765333 0 0 0 3.584-44.373333 4.778667 4.778667 0 0 1 0-3.925333 4.437333 4.437333 0 0 1 2.389334-3.072l36.010666-20.821334a4.778667 4.778667 0 0 1 2.56 0 5.12 5.12 0 0 1 4.266667 2.389334 39.594667 39.594667 0 0 0 40.448 19.114666 135.168 135.168 0 0 1 45.397333 0A39.765333 39.765333 0 0 0 845.312 580.266667a4.949333 4.949333 0 0 1 6.826667-1.706667l36.010666 20.821333a4.437333 4.437333 0 0 1 2.389334 3.072 4.778667 4.778667 0 0 1 0 3.925334 39.253333 39.253333 0 0 0 3.584 44.202666 145.237333 145.237333 0 0 1 22.869333 39.936A39.594667 39.594667 0 0 0 953.344 716.8a4.949333 4.949333 0 0 1 5.12 5.12z" fill="#3D3D63" p-id="20422"></path><path d="M782.165333 664.576a77.482667 77.482667 0 1 0 77.482667 77.482667 77.482667 77.482667 0 0 0-77.482667-77.482667z m0 120.832a43.349333 43.349333 0 1 1 43.349334-43.349333A43.349333 43.349333 0 0 1 782.165333 785.066667z" fill="#3D3D63" p-id="20423"></path></svg> 小吴の前端开发 (2)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item" style="visibility: hidden"></div><div class="magnet_item" style="visibility: hidden"></div><a class="magnet_link_more"  href="https://binwenwu.github.io/categories" style="flex:1;text-align: center;margin-bottom: 10px;">查看更多...</a></div></div>';
    console.log('已挂载magnet')
    parent.insertAdjacentHTML("afterbegin",child)}
     </script><style>#catalog_magnet{flex-wrap: wrap;display: flex;width:100%;justify-content:space-between;padding: 10px 10px 0 10px;align-content: flex-start;}.magnet_item{flex-basis: calc(33.333333333333336% - 5px);background: #f2f2f2;margin-bottom: 10px;border-radius: 8px;transition: all 0.2s ease-in-out;}.magnet_item:hover{background: #b30070}.magnet_link_more{color:#555}.magnet_link{color:black}.magnet_link:hover{color:white}@media screen and (max-width: 600px) {.magnet_item {flex-basis: 100%;}}.magnet_link_context{display:flex;padding: 10px;font-size:16px;transition: all 0.2s ease-in-out;}.magnet_link_context:hover{padding: 10px 20px;}</style>
    <style></style><script data-pjax>function history_calendar_injector_config(){
                var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
                var item_html = '<div class="card-widget card-history"><div class="card-content"><div class="item-headline"><i class="fas fa-clock fa-spin"></i><span>那年今日</span></div><div id="history-baidu" style="height: 100px;overflow: hidden"><div class="history_swiper-container" id="history-container" style="width: 100%;height: 100%"><div class="swiper-wrapper" id="history_container_wrapper" style="height:20px"></div></div></div></div>';
                console.log('已挂载history_calendar')
                // parent_div_git.innerHTML=item_html+parent_div_git.innerHTML // 无报错，但不影响使用(支持pjax跳转)
                parent_div_git.insertAdjacentHTML("afterbegin",item_html) // 有报错，但不影响使用(支持pjax跳转)
            }if( document.getElementsByClassName('sticky_layout')[0] && (location.pathname ==='/'|| '/' ==='all')){

            history_calendar_injector_config()
        } </script><script data-pjax  src="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.js"></script><script data-pjax src="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-card-history/baiduhistory/js/main.js"></script><script data-pjax>
  function butterfly_clock_anzhiyu_injector_config(){
    var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
    var item_html = '<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img class="entered loading" id="card-clock-loading" src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading"/></div></div></div></div></div>';
    console.log('已挂载butterfly_clock_anzhiyu')
    if(parent_div_git) {
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = '/';
  var qweather_key = 'a74f8aec62e44598bba953546055c108';
  var gaud_map_key = '1ee68cf0e3918adbfab2ecd0fad12a4a';
  var baidu_ak_key = 'undefined';
  var flag = 0;
  var clock_rectangle = '114.082279,30.49409';
  var clock_default_rectangle_enable = 'false';

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_clock_anzhiyu_injector_config();
  }
  else if (epage === cpage){
    butterfly_clock_anzhiyu_injector_config();
  }
  </script><script src="https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"></script><script data-pjax src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/clock.min.js"></script><script data-pjax>
  function butterfly_footer_beautify_injector_config(){
    var parent_div_git = document.getElementById('footer');
    var item_html = '<footer id="footer" style="background: transparent"><div id="footer_icons"><div><a class="icon_link" target="_blank" rel="noopener external nofollow" href="https://tankenqi.cn/" title="个人主页"><i class="fa-solid fa-compass"></i></a><a class="icon_link" target="_blank" rel="noopener external nofollow" href="https://res.abeim.cn/api/qq/?qq=2390726421" title="联系QQ"><i class="fa-brands fa-qq"></i></a><a class="icon_link" href="/404/" title="联系微信(待开发)"><i class="fa-brands fa-weixin"></i></a><a class="icon_link" target="_blank" rel="noopener external nofollow" href="mailto:2390726421@qq.com" title="发送邮件"><i class="fa-solid fa-envelope"></i></a></div><img class="footer_logo" src="https://img01.anheyu.com/useruploads/8/2022/12/15/639adf5b8806a.png" onclick="btf.scrollToDest(0,500)" title="返回顶部"/><div><a class="icon_link" target="_blank" rel="noopener external nofollow" href="https://github.com/binwenwu" title="Github主页"><i class="fa-brands fa-github"></i></a><a class="icon_link" target="_blank" rel="noopener external nofollow" href="https://space.bilibili.com/353113412" title="哔哩哔哩主页"><i class="fa-brands fa-bilibili"></i></a><a class="icon_link" href="/stars/" title="藏宝阁"><i class="fa-solid fa-star"></i></a><a class="icon_link" href="/404/" title="留言(待开发)"><i class="fa-solid fa-comment"></i></a></div></div><div id="footer_content"><div class="footer-group"><h3 class="footer-title">直达</h3><div class="footer-links"><a class="footer-item" href="/stars/">藏宝阁</a><a class="footer-item" href="/link/">友链订阅</a><a class="footer-item" href="/records/">文字瞬间</a><a class="footer-item" href="/subscribe/">文章订阅</a></div></div><div class="footer-group"><h3 class="footer-title">关于</h3><div class="footer-links"><a class="footer-item" href="/about/">关于我</a></div></div><div class="footer-group"><h3 class="footer-title">分类</h3><div class="footer-links"><a class="footer-item" href="/categories/Linux">Linux</a><a class="footer-item" href="/categories/云原生">云原生</a><a class="footer-item" href="/categories/GIS">GIS</a><a class="footer-item" href="/categories/前端开发">前端开发</a></div></div><div class="footer-group" id="friend-links-in-footer"><h3 class="footer-title">友链<button title="换一批" href="javascript:;" onclick="marcus.randomLink()"><i class="fa-solid fa-rotate-right"></i></button></h3><div class="footer-links"><a class="footer-item" target="_blank" href="https://blog.marcus233.top/" rel="external nofollow noreferrer">Marcus </a><a class="footer-item" target="_blank" href="https://blog.leonus.cn/" rel="external nofollow noreferrer">Leonus </a><a class="footer-item" target="_blank" href="https://blog.zhheo.com/" rel="external nofollow noreferrer">Zhheo </a><a class="footer-item" target="_blank" href="https://chuckle.top/" rel="external nofollow noreferrer">Chuckle</a><a class="footer-item" target="_blank" href="https://akilar.top/" rel="external nofollow noreferrer">Akilar</a><a class="footer-item" href="/link/" data-pjax-state="data-pjax-state">查看更多</a></div></div></div><div id="footer-bottom"><div class="footer-bottom-content"><div class="footer-bottom-left"><span class="copyright">&copy;2022 - 2023 By <a target="_blank" rel="noopener external nofollow noreferrer" href="https://tankenqi.cn/" title="点击访问&quot;Tankenqi&quot;的主页" style="margin-left:5px">Tankenqi</a></span><div><a class="footer-bottom-link" target="_blank" href="https://rainyun.com/" rel="noopener external nofollow" title="本站CDN支持">雨云</a><a class="footer-bottom-link" target="_blank" href="https://www.netdun.net/" rel="noopener external nofollow" title="本站CDN防护主要提供商:网盾星球">网盾星球</a><a class="footer-bottom-link" target="_blank" href="https://icp.gov.moe/?keyword=20230346" rel="noopener external nofollow" title="萌ICP备20230346">萌ICP备20230346</a></div></div><div class="footer-bottom-right"><div id="runtime" title="已运行时长">本站已运行：0 天 0 时 0 分 0 秒</div><div><a class="footer-bottom-link" target="_blank" href="https://hexo.io/zh-cn/" rel="noopener external nofollow" title="框架">Hexo</a><a class="footer-bottom-link" target="_blank" href="https://butterfly.js.org/" rel="noopener external nofollow" title="主题">Butterfly</a></div></div></div></div></footer>';
    console.log('已挂载butterfly_footer_beautify')
    parent_div_git.innerHTML=item_html
    }
  var elist = 'undefined'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_footer_beautify_injector_config();
  }
  else if (epage === cpage){
    butterfly_footer_beautify_injector_config();
  }
  </script><script defer src="https://cdn1.tianli0.top/npm/hexo-butterfly-footer-marcus/lib/footer.min.js"></script><script async src="//at.alicdn.com/t/font_2032782_8d5kxvn09md.js"></script><!-- hexo injector body_end end --></body></html>